function e(e,t){for(let[n,r]of Object.entries(t))e.addEventListener(n,r);return()=>{for(let[n,r]of Object.entries(t))e.removeEventListener(n,r)}}function t(e,t={}){let{selectorPrefix:n=`[data-egg-item="`,selectorSuffix:r=`"]`,excludeSelector:i=``,maxColumns:a}=t,o=[];for(let t of e){let e=a?Math.min(t.width,a):t.width,s=a?Math.max(1,Math.min(t.column,a-e+1)):t.column,c=`${n}${t.id}${r}${i}`,l=`${s} / span ${e}`,u=`${t.row} / span ${t.height}`;o.push(`${c} { grid-column: ${l}; grid-row: ${u}; }`)}return o.join(`
`)}function n(e){let t=e.querySelectorAll(`[data-egg-item]`);return Array.from(t).map(e=>{let t=e,n=getComputedStyle(t),r=parseInt(n.gridColumnStart,10)||1,i=parseInt(n.gridRowStart,10)||1,a=parseInt(t.getAttribute(`data-egg-colspan`)||`1`,10)||1,o=parseInt(t.getAttribute(`data-egg-rowspan`)||`1`,10)||1;return{id:t.dataset.eggItem||t.dataset.id||``,column:r,row:i,width:a,height:o}})}function r(r,i,a={}){let{selectorPrefix:o=`[data-egg-item="`,selectorSuffix:s=`"]`,core:c,layoutModel:l}=a,u=c?.styles??null;function d(){let e=getComputedStyle(r).gridTemplateColumns.split(` `).filter(Boolean);return Math.max(1,e.length)}let f=null,p=null,m=null,h=null,g=0,_=null,v=null,y=null,b=null,x=null,S=null,C=null;function w(e){return e.dataset.eggItem||e.dataset.id||``}function T(e,t){return n(r).map(n=>{let r=t.get(n.id);return r&&n.id!==e?{...n,column:r.column,row:r.row}:n})}function E(e,t,n,r,i){let a=[];for(let[o,s]of e)o===t?a.push({id:o,column:n.column,row:n.row,width:r,height:i}):a.push({id:o,column:s.column,row:s.row,width:s.width,height:s.height});return a}function D(e,t,n){if(!l||!t)return;let r=new Map;for(let t of e)r.set(t.id,{column:t.column,row:t.row});l.saveLayout(t,r),n&&n(),u&&(u.clear(`preview`),u.commit()),c&&c.emit(`layout-change`,{items:e,columnCount:t})}function O(e,n,i,a){let c=++g,l=_??C,d=()=>{if(c===g){if(u){let i=t(n?e.filter(e=>e.id!==n):e,{selectorPrefix:o,selectorSuffix:s,maxColumns:l??void 0});u.set(`preview`,i),u.commit();let a=r.querySelectorAll(`[data-egg-item]`);for(let e of a){let t=e,r=w(t),i=t.style.viewTransitionName;r!==n&&i!==`none`&&(t.style.gridColumn=``,t.style.gridRow=``)}}else{let t=r.querySelectorAll(`[data-egg-item]`);for(let r of t){let t=r,i=w(t);if(i===n)continue;let a=e.find(e=>e.id===i);if(a){let e=parseInt(t.getAttribute(`data-egg-colspan`)||`1`,10)||1,n=parseInt(t.getAttribute(`data-egg-rowspan`)||`1`,10)||1;t.style.gridColumn=`${a.column} / span ${e}`,t.style.gridRow=`${a.row} / span ${n}`}}}a&&a()}};i&&`startViewTransition`in document?(m&&n&&(m.style.viewTransitionName=`dragging`),document.startViewTransition(d)):d()}let k=e=>{let i=e.detail;m=i.item,p=w(i.item),h=i.source,_=d();let a=n(r);f=new Map;for(let e of a)f.set(e.id,{column:e.column,row:e.row});if(u){let e=r.querySelectorAll(`[data-egg-item]`);for(let t of e){let e=t;e!==m&&(e.style.gridColumn=``,e.style.gridRow=``)}let n=t(a,{selectorPrefix:o,selectorSuffix:s,maxColumns:_});u.set(`preview`,n),u.commit()}},A=null,j=e=>{if(!p||!f)return;let t=e.detail;if(c?.cameraScrolling){A=t.cell;return}A=null;let n=T(p,f),a=_??d(),o=i.calculateDragLayout(n,p,t.cell,a);O(o,p,!0),i.afterDragMove&&i.afterDragMove(o,p,r)},M=e=>{if(!p||!f)return;let t=e.detail,n=T(p,f),r=_??d(),a=i.calculateDragLayout(n,p,t.cell,r),o=h===`pointer`;m&&m.style.viewTransitionName===`dragging`&&(m.style.viewTransitionName=``);let s=!o,c=_;O(a,null,s,()=>D(a,c)),p=null,m=null,h=null,f=null,A=null,_=null},N=()=>{if(!p||!f)return;m&&m.style.viewTransitionName===`dragging`&&(m.style.viewTransitionName=``);let e=T(null,f),t=()=>O(e,null,!1);`startViewTransition`in document?document.startViewTransition(t):t(),p=null,m=null,h=null,f=null,A=null,_=null},P=()=>{if(!p||!f)return;let e=A;if(!e&&m){let t=m.getBoundingClientRect(),n=t.left+t.width/2,r=t.top+t.height/2;e=c?.getCellFromPoint(n,r)??null}if(!e)return;A=null;let t=T(p,f),n=_??d(),a=i.calculateDragLayout(t,p,e,n);O(a,p,!0),i.afterDragMove&&i.afterDragMove(a,p,r)},F=e=>{if(!i.calculateResizeLayout)return;let a=e.detail;y=a.item,v=w(a.item),b=a.source,C=d();let c=n(r);x=new Map;for(let e of c)x.set(e.id,{column:e.column,row:e.row,width:e.width,height:e.height});if(u){let e=r.querySelectorAll(`[data-egg-item]`);for(let t of e){let e=t;e!==y&&(e.style.gridColumn=``,e.style.gridRow=``)}let n=t(c,{selectorPrefix:o,selectorSuffix:s,maxColumns:C});u.set(`preview`,n),u.commit()}S=null},I=e=>{if(!i.calculateResizeLayout||!v||!x)return;let t=e.detail;if(S&&S.cell.column===t.cell.column&&S.cell.row===t.cell.row&&S.colspan===t.colspan&&S.rowspan===t.rowspan)return;S={cell:{...t.cell},colspan:t.colspan,rowspan:t.rowspan};let n=E(x,v,t.cell,t.colspan,t.rowspan),r=C??d();O(i.calculateResizeLayout(n,v,t.cell,t.colspan,t.rowspan,r),v,!0)},L=e=>{if(!i.calculateResizeLayout||!v||!x)return;let t=e.detail,n=E(x,v,t.cell,t.colspan,t.rowspan),r=C??d(),a=i.calculateResizeLayout(n,v,t.cell,t.colspan,t.rowspan,r),o=b!==`pointer`,s=v,c=C;O(a,null,o,()=>D(a,c,()=>{l.updateItemSize(s,{width:t.colspan,height:t.rowspan})})),v=null,y=null,b=null,x=null,S=null,C=null},R=()=>{if(!v||!x)return;let e=Array.from(x,([e,t])=>({id:e,column:t.column,row:t.row,width:t.width,height:t.height})),t=()=>O(e,null,!1);`startViewTransition`in document?document.startViewTransition(t):t(),v=null,y=null,b=null,x=null,S=null,C=null};return e(r,{"egg-drag-start":k,"egg-drag-move":j,"egg-drag-end":M,"egg-drag-cancel":N,"egg-camera-settled":P,"egg-resize-start":F,"egg-resize-move":I,"egg-resize-end":L,"egg-resize-cancel":R})}function i(e){return[...e].sort((e,t)=>e.row-t.row||e.column-t.column)}function a(e,t,n,r,i,a){if(t+r-1>a)return!1;for(let a=n;a<n+i;a++)for(let n=t;n<t+r;n++)if(e.has(`${n},${a}`))return!1;return!0}function o(e,t,n,r,i){for(let a=n;a<n+i;a++)for(let n=t;n<t+r;n++)e.add(`${n},${a}`)}function s(e,t){let n=new Set,r=[];for(let i of e){let e=Math.min(i.width,t),s=!1;for(let c=1;!s;c++){for(let l=1;l<=t;l++)if(a(n,l,c,e,i.height,t)){o(n,l,c,e,i.height),r.push({...i,column:l,row:c,width:e}),s=!0;break}c>100&&(r.push({...i,column:1,row:c,width:e}),o(n,1,c,e,i.height),s=!0)}}return r}function c(e,t){return e.row<t.row||e.row===t.row&&e.column<t.column}function l(e,t,n,r){let{columns:a}=r,o=i(e.map(e=>({...e}))),l=o.find(e=>e.id===t);if(!l)return s(o,a);let u=o.filter(e=>e.id!==t),d=s(u,a),f=d.length;for(let e=0;e<d.length;e++)if(!c(d[e],n)){f=e;break}return s([...u.slice(0,f),l,...u.slice(f)],a)}function u(e,t={}){return r(e,{calculateDragLayout(e,t,n,r){return l(e,t,n,{columns:r})},afterDragMove(e,t,n){let r=e.find(e=>e.id===t);if(r){let e={cell:{column:r.column,row:r.row},colspan:r.width,rowspan:r.height};queueMicrotask(()=>{n.dispatchEvent(new CustomEvent(`egg-drop-preview`,{detail:e,bubbles:!0}))})}},calculateResizeLayout(e,t,n,r,i,a){return s([...e].sort((e,t)=>e.row-t.row||e.column-t.column),a)}},t)}export{u as attachReorderAlgorithm,l as calculateReorderLayout,i as getItemOrder,t as layoutToCSS,s as reflowItems};
//# sourceMappingURL=algorithm-reorder.min.js.map