function e(e){return e.split(` `).filter(Boolean).map(e=>parseFloat(e)||0)}function t(e,t,n){let r=0,i=n/2;for(let a=0;a<t.length;a++){if(e<=r+t[a]+i)return a+1;r+=t[a]+n}return t.length||1}function n(e){let t=getComputedStyle(e);return{column:parseInt(t.gridColumnStart,10)||1,row:parseInt(t.gridRowStart,10)||1}}function r(e){return{colspan:parseInt(e.getAttribute(`data-egg-colspan`)||`1`,10)||1,rowspan:parseInt(e.getAttribute(`data-egg-rowspan`)||`1`,10)||1}}function i(e){return e.dataset.eggItem||e.dataset.id||e.id||``}function a(e,t={}){let{selectorPrefix:n=`[data-egg-item="`,selectorSuffix:r=`"]`,excludeId:i,maxColumns:a}=t,o=[];for(let t of e){if(t.id===i)continue;let e=a?Math.min(t.width,a):t.width,s=a?Math.max(1,Math.min(t.column,a-e+1)):t.column;o.push(`${n}${t.id}${r} { grid-column: ${s} / span ${e}; grid-row: ${t.row} / span ${t.height}; }`)}return o.join(`
`)}function o(e){return Array.from(e.querySelectorAll(`[data-egg-item]`)).map(e=>{let t=e,n=getComputedStyle(t);return{id:i(t),column:parseInt(n.gridColumnStart,10)||1,row:parseInt(n.gridRowStart,10)||1,width:parseInt(t.getAttribute(`data-egg-colspan`)||`1`,10)||1,height:parseInt(t.getAttribute(`data-egg-rowspan`)||`1`,10)||1}})}function s(e,t){return!(e.column+e.width<=t.column||t.column+t.width<=e.column||e.row+e.height<=t.row||t.row+t.height<=e.row)}function c(e,t,n,r=0){if(r>50)return;let i=e.filter(e=>e.id!==n&&e.id!==t.id&&s(t,e)).sort((e,t)=>t.row-e.row||e.column-t.column);for(let a of i){let i=t.row+t.height;a.row<i&&(a.row=i,c(e,a,n,r+1))}}function l(e,t){let n=[...e].filter(e=>e.id!==t).sort((e,t)=>e.row-t.row||e.column-t.column);for(let t of n){let n=0;for(;t.row>1&&n++<100;)if(--t.row,e.some(e=>e.id!==t.id&&s(t,e))){t.row+=1;break}}}function u(e,t,n,r=!0){let i=e.map(e=>({...e})),a=i.find(e=>e.id===t);return a?(a.column=n.column,a.row=n.row,c(i,a,t),r&&l(i,t),i):i}function d(e,t){let n=new Set,r=[];for(let i of e){let e=Math.min(i.width,t),a=!1;for(let o=1;!a;o++){for(let s=1;s<=t;s++){let c=s+e-1<=t;if(c)for(let t=o;t<o+i.height&&c;t++)for(let r=s;r<s+e&&c;r++)n.has(`${r},${t}`)&&(c=!1);if(c){for(let t=o;t<o+i.height;t++)for(let r=s;r<s+e;r++)n.add(`${r},${t}`);r.push({...i,column:s,row:o,width:e}),a=!0;break}}o>100&&(r.push({...i,column:1,row:o,width:e}),a=!0)}}return r}function f(e,t,n,r){let i=[...e.map(e=>({...e}))].sort((e,t)=>e.row-t.row||e.column-t.column),a=i.find(e=>e.id===t);if(!a)return d(i,r);let o=i.filter(e=>e.id!==t),s=d(o,r),c=s.length;for(let e=0;e<s.length;e++){let t=s[e];if(t.row>n.row||t.row===n.row&&t.column>=n.column){c=e;break}}return d([...o.slice(0,c),a,...o.slice(c)],r)}function p(s,c={}){let l=[],p=c.styleElement??document.createElement(`style`);c.styleElement||(document.head.appendChild(p),l.push(()=>p.remove()));let m=p.textContent?.trim()||``,h=null,g={element:s,phase:`idle`,interaction:null,cameraScrolling:!1,baseCSS:m,previewCSS:``,get selectedItem(){return h},set selectedItem(e){this.select(e)},select(e){if(e===h)return;let t=h;t&&t.removeAttribute(`data-egg-selected`),e?(this.phase=this.phase===`idle`?`selected`:this.phase,h=e,e.setAttribute(`data-egg-selected`,``),this.emit(`select`,{item:e})):(this.phase===`selected`&&(this.phase=`idle`),h=null,t&&this.emit(`deselect`,{item:t}))},deselect(){this.select(null)},getCellFromPoint(n,r){let i=s.getBoundingClientRect();if(n<i.left||n>i.right||r<i.top||r>i.bottom)return null;let a=getComputedStyle(s),o=e(a.gridTemplateColumns),c=e(a.gridTemplateRows),l=parseFloat(a.columnGap)||0,u=parseFloat(a.rowGap)||0;return{column:t(n-i.left+s.scrollLeft,o,l),row:t(r-i.top+s.scrollTop,c,u)}},getGridInfo(){let t=s.getBoundingClientRect(),n=getComputedStyle(s),r=e(n.gridTemplateColumns),i=e(n.gridTemplateRows);return{rect:t,columns:r,rows:i,gap:parseFloat(n.columnGap)||0,cellWidth:r[0]||0,cellHeight:i[0]||0}},emit(e,t){s.dispatchEvent(new CustomEvent(`egg-${e}`,{bubbles:!0,detail:t}))},commitStyles(){p.textContent=[this.baseCSS,this.previewCSS].filter(Boolean).join(`

`)},destroy(){l.forEach(e=>e())}};if(c.pointer!==!1){let e=.5,t=.4,a=null,o=null;function c(e,t){let{item:n,pointerId:r,rect:s,startCell:c,colspan:l,rowspan:u}=e;o={item:n,pointerId:r,offsetX:t.clientX-s.left,offsetY:t.clientY-s.top,initialRect:s,startCell:c,lastCell:c,lastChangeTime:0,colspan:l,rowspan:u,dragStartX:t.clientX,dragStartY:t.clientY},n.setAttribute(`data-egg-dragging`,``),document.body.classList.add(`is-dragging`);let d=i(n);g.phase=`interacting`,g.interaction={type:`drag`,mode:`pointer`,itemId:d,element:n,columnCount:g.getGridInfo().columns.length},g.emit(`drag-start`,{item:n,cell:c,colspan:l,rowspan:u,source:`pointer`}),n.style.position=`fixed`,n.style.left=`${s.left}px`,n.style.top=`${s.top}px`,n.style.width=`${s.width}px`,n.style.height=`${s.height}px`,n.style.zIndex=`100`,a=null}let u=n=>{if(a&&!o){let e=n.clientX-a.startX,t=n.clientY-a.startY;if(Math.sqrt(e*e+t*t)>=5)c(a,n);else return}if(!o)return;let{item:r,offsetX:i,offsetY:s,initialRect:l,colspan:u,rowspan:d}=o,f=n.clientX-i,p=n.clientY-s;r.style.left=`${f}px`,r.style.top=`${p}px`;let m=f+l.width/2,h=p+l.height/2,_=g.getGridInfo(),v=n.clientX-o.dragStartX,y=n.clientY-o.dragStartY;Math.abs(v)>30&&(m+=Math.sign(v)*e*(_.cellWidth+_.gap)),Math.abs(y)>30&&(h+=Math.sign(y)*e*(_.cellHeight+_.gap));let b=g.getCellFromPoint(m,h);if(!b)return;let x=Math.max(1,_.columns.length-u+1),S=Math.max(1,_.rows.length-d+1),C={column:Math.max(1,Math.min(x,b.column)),row:Math.max(1,Math.min(S,b.row))},w=performance.now();if(w-o.lastChangeTime<40||C.column===o.lastCell.column&&C.row===o.lastCell.row)return;let T=_.cellWidth+_.gap,E=_.cellHeight+_.gap,D=_.rect.left+(o.lastCell.column-1)*T+_.cellWidth/2,O=_.rect.top+(o.lastCell.row-1)*E+_.cellHeight/2,k=(m-D)/T,A=(h-O)/E,j=C.column>o.lastCell.column==k>0,M=C.row>o.lastCell.row==A>0;Math.abs(k)<(j?.5:.5+t)&&Math.abs(A)<(M?.5:.5+t)||(o.lastCell=C,o.lastChangeTime=w,g.emit(`drag-move`,{item:r,cell:C,x:n.clientX,y:n.clientY,colspan:u,rowspan:d,source:`pointer`}))},d=()=>{if(o){let{item:e,pointerId:t}=o;e.removeAttribute(`data-egg-dragging`),document.body.classList.remove(`is-dragging`),e.style.position=``,e.style.left=``,e.style.top=``,e.style.width=``,e.style.height=``,e.style.zIndex=``,e.releasePointerCapture(t),e.removeEventListener(`pointermove`,u),e.removeEventListener(`pointerup`,f),e.removeEventListener(`pointercancel`,p),o=null}a&&=(a.item.releasePointerCapture(a.pointerId),a.item.removeEventListener(`pointermove`,u),a.item.removeEventListener(`pointerup`,f),a.item.removeEventListener(`pointercancel`,p),null)},f=t=>{if(a&&!o){d();return}if(!o)return;let{item:n,initialRect:r,colspan:s,rowspan:c,lastCell:l,offsetX:u,offsetY:f,dragStartX:p,dragStartY:m}=o,h=g.getGridInfo(),_=t.clientX-p,v=t.clientY-m,y=t.clientX-u,b=t.clientY-f,x=y+r.width/2,S=b+r.height/2;Math.abs(_)>30&&(x+=Math.sign(_)*e*(h.cellWidth+h.gap)),Math.abs(v)>30&&(S+=Math.sign(v)*e*(h.cellHeight+h.gap));let C=g.getCellFromPoint(x,S),w=n.getBoundingClientRect(),T=l;if(C){let e=Math.max(1,h.columns.length-s+1),t=Math.max(1,h.rows.length-c+1);T={column:Math.max(1,Math.min(e,C.column)),row:Math.max(1,Math.min(t,C.row))}}g.emit(`drag-end`,{item:n,cell:T,colspan:s,rowspan:c,source:`pointer`}),d(),g.phase=`selected`,g.interaction=null,requestAnimationFrame(()=>{let e=n.getBoundingClientRect(),t=w.left-e.left,r=w.top-e.top;if(Math.abs(t)>1||Math.abs(r)>1){n.style.viewTransitionName=`none`,n.setAttribute(`data-egg-dropping`,``);let e=n.animate([{transform:`translate(${t}px, ${r}px)`},{transform:`none`}],{duration:200,easing:`cubic-bezier(0.2, 0, 0, 1)`});e.onfinish=()=>{n.removeAttribute(`data-egg-dropping`);let e=i(n);n.style.viewTransitionName=e||``}}})},p=()=>{o&&(g.emit(`drag-cancel`,{item:o.item,source:`pointer`}),g.phase=`selected`,g.interaction=null),d()},m=e=>{let t=e.target.closest(`[data-egg-item]`);if(!t)return;g.select(t),e.preventDefault();let i=t.getBoundingClientRect();a={item:t,pointerId:e.pointerId,startX:e.clientX,startY:e.clientY,rect:i,startCell:n(t),...r(t)},t.setPointerCapture(e.pointerId),t.addEventListener(`pointermove`,u),t.addEventListener(`pointerup`,f),t.addEventListener(`pointercancel`,p)},h=e=>{s.contains(e.target)||o||g.deselect()};s.addEventListener(`pointerdown`,m),document.addEventListener(`pointerdown`,h),l.push(()=>{s.removeEventListener(`pointerdown`,m),document.removeEventListener(`pointerdown`,h),d()})}if(c.resize!==!1){let e=typeof c.resize==`object`?c.resize:{},t=e.handles??`corners`,n=e.handleSize??12,a=e.minSize??{colspan:1,rowspan:1},o=e.maxSize??{colspan:6,rowspan:6},u=e.showSizeLabel??!0,d={nw:`nwse-resize`,se:`nwse-resize`,ne:`nesw-resize`,sw:`nesw-resize`,n:`ns-resize`,s:`ns-resize`,e:`ew-resize`,w:`ew-resize`},f=null,p=null,m=null;function h(e,r){let i=r.getBoundingClientRect(),a=e.clientX-i.left,o=e.clientY-i.top,s=a<n,c=a>i.width-n,l=o<n,u=o>i.height-n;if(t===`corners`||t===`all`){if(l&&s)return`nw`;if(l&&c)return`ne`;if(u&&s)return`sw`;if(u&&c)return`se`}if(t===`edges`||t===`all`){if(l)return`n`;if(u)return`s`;if(s)return`w`;if(c)return`e`}return null}function _(e,t,n){e.releasePointerCapture(t),e.removeEventListener(`pointermove`,v),e.removeEventListener(`pointerup`,y),e.removeEventListener(`pointercancel`,b),n&&n.remove(),e.style.position=``,e.style.left=``,e.style.top=``,e.style.width=``,e.style.height=``,e.style.zIndex=``;let r=i(e);e.style.viewTransitionName=r||``,e.removeAttribute(`data-egg-resizing`),e.removeAttribute(`data-egg-handle-active`)}let v=e=>{if(!f||e.pointerId!==f.pointerId)return;let{item:t,handle:n,startCell:r,origSize:i,initRect:s,startX:c,startY:l,sizeLabel:u}=f,d=g.getGridInfo(),p=e.clientX-c,m=e.clientY-l,h=s.width,_=s.height,v=s.left,y=s.top,b=d.cellWidth,x=d.cellHeight,S=Math.min(o.colspan*d.cellWidth+(o.colspan-1)*d.gap,d.rect.right-s.left),C=Math.min(o.rowspan*d.cellHeight+(o.rowspan-1)*d.gap,d.rect.bottom-s.top);if((n===`e`||n===`se`||n===`ne`)&&(h=Math.max(b,Math.min(S,s.width+p))),n===`w`||n===`sw`||n===`nw`){let e=s.left-d.rect.left,t=Math.min(o.colspan*d.cellWidth+(o.colspan-1)*d.gap,s.width+e),n=Math.max(-s.width+b,Math.min(t-s.width,-p));h=s.width+n,v=s.left-n}if((n===`s`||n===`se`||n===`sw`)&&(_=Math.max(x,Math.min(C,s.height+m))),n===`n`||n===`ne`||n===`nw`){let e=s.top-d.rect.top,t=Math.min(o.rowspan*d.cellHeight+(o.rowspan-1)*d.gap,s.height+e),n=Math.max(-s.height+x,Math.min(t-s.height,-m));_=s.height+n,y=s.top-n}t.style.left=`${v}px`,t.style.top=`${y}px`,t.style.width=`${h}px`,t.style.height=`${_}px`;let w=d.cellWidth+d.gap,T=d.cellHeight+d.gap,E=.3,D=Math.max(a.colspan,Math.min(o.colspan,Math.floor((h+d.gap)/w+(1-E)))),O=Math.max(a.rowspan,Math.min(o.rowspan,Math.floor((_+d.gap)/T+(1-E)))),k=r.column,A=r.row;(n===`w`||n===`sw`||n===`nw`)&&(k=r.column+i.colspan-D),(n===`n`||n===`ne`||n===`nw`)&&(A=r.row+i.rowspan-O),f.curSize={colspan:D,rowspan:O},f.curCell={column:k,row:A},u&&(u.textContent=`${D}\u00d7${O}`);let j;j=n===`se`||n===`s`||n===`e`?{column:r.column,row:r.row}:n===`nw`||n===`n`||n===`w`?{column:r.column+i.colspan-1,row:r.row+i.rowspan-1}:n===`ne`?{column:r.column,row:r.row+i.rowspan-1}:{column:r.column+i.colspan-1,row:r.row},g.emit(`resize-move`,{item:t,cell:{column:k,row:A},anchorCell:j,startCell:r,colspan:D,rowspan:O,handle:n,source:`pointer`})},y=e=>{if(!f||e.pointerId!==f.pointerId)return;let{item:t,pointerId:n,curSize:r,curCell:i,sizeLabel:a}=f;t.setAttribute(`data-egg-colspan`,String(r.colspan)),t.setAttribute(`data-egg-rowspan`,String(r.rowspan)),g.emit(`resize-end`,{item:t,cell:i,colspan:r.colspan,rowspan:r.rowspan,source:`pointer`}),_(t,n,a),f=null,g.phase=`selected`,g.interaction=null},b=e=>{!f||e.pointerId!==f.pointerId||(g.emit(`resize-cancel`,{item:f.item,source:`pointer`}),_(f.item,f.pointerId,f.sizeLabel),f=null,g.phase=`selected`,g.interaction=null)},x=e=>{let t=e.target.closest(`[data-egg-item]`);if(!t)return;let n=h(e,t);if(!n)return;e.stopPropagation(),e.preventDefault(),g.select(t);let{colspan:a,rowspan:o}=r(t),s=getComputedStyle(t),c={column:parseInt(s.gridColumnStart,10)||1,row:parseInt(s.gridRowStart,10)||1},l=t.getBoundingClientRect(),d=null;u&&(d=document.createElement(`div`),d.className=`egg-resize-label`,d.style.cssText=`position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.8);color:white;padding:4px 8px;border-radius:4px;font-size:14px;font-weight:600;font-family:system-ui,sans-serif;pointer-events:none;z-index:1000;white-space:nowrap`,d.textContent=`${a}\u00d7${o}`,t.appendChild(d)),f={item:t,pointerId:e.pointerId,handle:n,startCell:c,origSize:{colspan:a,rowspan:o},curCell:{...c},curSize:{colspan:a,rowspan:o},sizeLabel:d,initRect:l,startX:e.clientX,startY:e.clientY},t.setAttribute(`data-egg-resizing`,``),t.setAttribute(`data-egg-handle-active`,n),t.removeAttribute(`data-egg-handle-hover`),t.setPointerCapture(e.pointerId),t.addEventListener(`pointermove`,v),t.addEventListener(`pointerup`,y),t.addEventListener(`pointercancel`,b),g.phase=`interacting`,g.interaction={type:`resize`,mode:`pointer`,itemId:i(t),element:t,columnCount:g.getGridInfo().columns.length},g.emit(`resize-start`,{item:t,cell:c,colspan:a,rowspan:o,handle:n,source:`pointer`}),t.style.position=`fixed`,t.style.left=`${l.left}px`,t.style.top=`${l.top}px`,t.style.width=`${l.width}px`,t.style.height=`${l.height}px`,t.style.zIndex=`100`,t.style.viewTransitionName=`resizing`},S=e=>{if(f)return;let t=e.target.closest(`[data-egg-item]`);if(t){let n=h(e,t);(n!==m||t!==p)&&(p&&p!==t&&(p.style.cursor=``,p.removeAttribute(`data-egg-handle-hover`)),p===t&&m&&!n&&t.removeAttribute(`data-egg-handle-hover`),p=t,m=n,t.style.cursor=(n?d[n]:``)||``,n?t.setAttribute(`data-egg-handle-hover`,n):t.removeAttribute(`data-egg-handle-hover`))}else p&&(p.style.cursor=``,p.removeAttribute(`data-egg-handle-hover`),p=null,m=null)},C=e=>{e.key===`Escape`&&f&&b(new PointerEvent(`pointercancel`,{pointerId:f.pointerId}))};s.addEventListener(`pointerdown`,x,{capture:!0}),s.addEventListener(`pointermove`,S),document.addEventListener(`keydown`,C),l.push(()=>{s.removeEventListener(`pointerdown`,x,{capture:!0}),s.removeEventListener(`pointermove`,S),document.removeEventListener(`keydown`,C)})}if(c.keyboard!==!1){let e=!1,t=null,a=null,o={ArrowUp:`up`,ArrowDown:`down`,ArrowLeft:`left`,ArrowRight:`right`,k:`up`,K:`up`,j:`down`,J:`down`,h:`left`,H:`left`,l:`right`,L:`right`},c={KeyK:`up`,KeyJ:`down`,KeyH:`left`,KeyL:`right`},u=(e,t)=>o[e]??c[t]??null,d=()=>g.phase===`interacting`&&g.interaction?.type===`drag`&&g.interaction.mode===`keyboard`,f=()=>d()?g.interaction.element:null,p=(e,t,n=1)=>t===`up`?{...e,row:Math.max(1,e.row-n)}:t===`down`?{...e,row:e.row+n}:t===`left`?{...e,column:Math.max(1,e.column-n)}:{...e,column:e.column+n},m=(e,t,r)=>{let i=Array.from(s.querySelectorAll(`[data-egg-item]`)),a=null,o=1/0;for(let s of i){if(s===r)continue;let i=n(s),c=!1,l=0;t===`up`?(c=i.row<e.row,l=e.row-i.row+Math.abs(i.column-e.column)*.1):t===`down`?(c=i.row>e.row,l=i.row-e.row+Math.abs(i.column-e.column)*.1):t===`left`?(c=i.column<e.column,l=e.column-i.column+Math.abs(i.row-e.row)*.1):(c=i.column>e.column,l=i.column-e.column+Math.abs(i.row-e.row)*.1),c&&l<o&&(o=l,a=s)}return a},h=o=>{if(o.key===`G`&&o.shiftKey&&!o.ctrlKey&&!o.altKey&&!o.metaKey){if(o.preventDefault(),e=!e,e){if(s.setAttribute(`data-egg-keyboard-mode`,``),!g.selectedItem){let e=s.querySelector(`[data-egg-item]`);e&&g.select(e)}}else s.removeAttribute(`data-egg-keyboard-mode`);return}let c=document.activeElement;if(!e&&!(c&&s.contains(c))&&!g.selectedItem)return;let l=g.selectedItem,d=u(o.key,o.code);if(o.key===`Escape`){o.preventDefault();let n=f();n?(n.removeAttribute(`data-egg-dragging`),g.emit(`drag-cancel`,{item:n,source:`keyboard`}),g.phase=`selected`,g.interaction=null,t=null):l&&g.deselect(),e&&(e=!1,s.removeAttribute(`data-egg-keyboard-mode`));return}if(o.key===`Enter`||o.key===` `){if(!l)return;o.preventDefault();let e=f();if(e){let i=t??n(e),a=r(e);e.removeAttribute(`data-egg-dragging`),g.emit(`drag-end`,{item:e,cell:i,colspan:a.colspan,rowspan:a.rowspan,source:`keyboard`}),g.phase=`selected`,g.interaction=null,t=null}else{let e=i(l),a=r(l),o=n(l);g.phase=`interacting`,g.interaction={type:`drag`,mode:`keyboard`,itemId:e,element:l,columnCount:g.getGridInfo().columns.length},t=o,l.setAttribute(`data-egg-dragging`,``),g.emit(`drag-start`,{item:l,cell:o,colspan:a.colspan,rowspan:a.rowspan,source:`keyboard`})}return}if(!d)return;if(o.preventDefault(),o.altKey&&!o.ctrlKey&&!o.shiftKey&&l){let e=m(n(l),d,l);e&&g.select(e);return}if(!l)return;let h=n(l),_=r(l),v=g.getGridInfo();if(o.shiftKey&&!o.ctrlKey&&!o.altKey){let e=_.colspan,t=_.rowspan;if(d===`right`?e=Math.min(_.colspan+1,v.columns.length-h.column+1):d===`left`?e=Math.max(1,_.colspan-1):t=d===`down`?_.rowspan+1:Math.max(1,_.rowspan-1),e===_.colspan&&t===_.rowspan)return;a&&=(clearTimeout(a.tid),a.item.style.removeProperty(`view-transition-name`),null);let n=d===`right`||d===`down`?`se`:d===`left`?`w`:`n`;g.phase=`interacting`,g.interaction={type:`resize`,mode:`keyboard`,itemId:i(l),element:l,columnCount:v.columns.length},l.style.viewTransitionName=`resizing`,g.emit(`resize-start`,{item:l,cell:h,colspan:_.colspan,rowspan:_.rowspan,handle:n}),l.setAttribute(`data-egg-colspan`,String(e)),l.setAttribute(`data-egg-rowspan`,String(t)),g.emit(`resize-end`,{item:l,cell:h,colspan:e,rowspan:t}),g.phase=`selected`,g.interaction=null;let r=l;a={item:r,tid:window.setTimeout(()=>{r.style.removeProperty(`view-transition-name`),a?.item===r&&(a=null)},250)};return}let y=1;(o.ctrlKey||o.metaKey)&&(y=d===`up`||d===`down`?_.rowspan:_.colspan);let b=p(h,d,y),x=Math.max(1,v.columns.length-_.colspan+1),S=Math.max(1,v.rows.length-_.rowspan+1),C={column:Math.max(1,Math.min(x,b.column)),row:Math.max(1,Math.min(S,b.row))};if(C.column===h.column&&C.row===h.row)return;let w=f();w?(t=C,g.emit(`drag-move`,{item:w,cell:C,x:0,y:0,colspan:_.colspan,rowspan:_.rowspan,source:`keyboard`})):(g.emit(`drag-start`,{item:l,cell:h,colspan:_.colspan,rowspan:_.rowspan,source:`keyboard`}),g.emit(`drag-end`,{item:l,cell:C,colspan:_.colspan,rowspan:_.rowspan,source:`keyboard`}))};document.addEventListener(`keydown`,h),l.push(()=>{document.removeEventListener(`keydown`,h),s.removeAttribute(`data-egg-keyboard-mode`)})}if(c.algorithm!==!1){let e=c.algorithm??`push`,t=c.compaction??!0,n=c.responsive?.layoutModel??c.layoutModel;function r(){let e=getComputedStyle(s);return Math.max(1,e.gridTemplateColumns.split(` `).filter(Boolean).length)}let p=null,m=0;function h(n,r,i,a,o,s){if(p?.type===`resize`&&o!=null&&s!=null){let c=n.map(e=>e.id===r?{...e,column:i.column,row:i.row,width:o,height:s}:e);return e===`reorder`?d([...c].sort((e,t)=>e.row-t.row||e.column-t.column),a):u(c,r,i,t)}return e===`reorder`?f(n,r,i,a):u(n,r,i,t)}function _(e,t){return o(s).map(n=>{let r=t.get(n.id);return r&&n.id!==e?{...n,column:r.column,row:r.row}:n})}function v(e,t,n,r,i){let a=[];for(let[o,s]of e)o===t?a.push({id:o,column:n.column,row:n.row,width:r,height:i}):a.push({...s});return a}function y(e,t,n,r){let o=++m;p&&(p.layout=e,p.version=o);let c=()=>{if(o!==m)return;g.previewCSS=a(e,{excludeId:t??void 0,maxColumns:p?.columnCount}),g.commitStyles();let n=s.querySelectorAll(`[data-egg-item]`);for(let e of n){let n=e;i(n)!==t&&n.style.viewTransitionName!==`none`&&(n.style.gridColumn=``,n.style.gridRow=``)}r?.()};n&&`startViewTransition`in document?(p?.type===`drag`&&p.element&&(p.element.style.viewTransitionName=`dragging`),document.startViewTransition(c)):c()}function b(e,t,r){if(!n||!t)return;let i=new Map;for(let t of e)i.set(t.id,{column:t.column,row:t.row});n.saveLayout(t,i),r?.(),g.previewCSS=``,g.commitStyles(),g.emit(`layout-change`,{items:e,columnCount:t})}let x=e=>{let t=e.detail,n=e.type===`egg-drag-start`,c=i(t.item),l=o(s),u=new Map;for(let e of l)u.set(e.id,{...e});p={type:n?`drag`:`resize`,itemId:c,element:t.item,source:t.source,columnCount:r(),originals:u,pendingCell:null,lastResize:null,layout:null,version:0};let d=s.querySelectorAll(`[data-egg-item]`);for(let e of d){let n=e;n!==t.item&&(n.style.gridColumn=``,n.style.gridRow=``)}g.previewCSS=a(l,{maxColumns:p.columnCount}),g.commitStyles()},S=t=>{if(!p)return;let n=t.detail;if(p.type===`drag`){if(g.cameraScrolling){p.pendingCell=n.cell;return}p.pendingCell=null;let t=h(_(p.itemId,p.originals),p.itemId,n.cell,p.columnCount);if(y(t,p.itemId,!0),e===`reorder`){let e=t.find(e=>e.id===p.itemId);if(e){let t={cell:{column:e.column,row:e.row},colspan:e.width,rowspan:e.height};queueMicrotask(()=>s.dispatchEvent(new CustomEvent(`egg-drop-preview`,{detail:t,bubbles:!0})))}}}else{let{cell:e,colspan:t,rowspan:r}=n;if(p.lastResize&&p.lastResize.cell.column===e.column&&p.lastResize.cell.row===e.row&&p.lastResize.colspan===t&&p.lastResize.rowspan===r)return;p.lastResize={cell:{...e},colspan:t,rowspan:r},y(h(v(p.originals,p.itemId,e,t,r),p.itemId,e,p.columnCount,t,r),p.itemId,!0)}},C=e=>{if(!p)return;let t=e.detail,r=p;r.element.style.viewTransitionName===`dragging`&&(r.element.style.viewTransitionName=``);let i=r.source!==`pointer`,a;a=r.type===`drag`?h(_(r.itemId,r.originals),r.itemId,t.cell,r.columnCount):h(v(r.originals,r.itemId,t.cell,t.colspan,t.rowspan),r.itemId,t.cell,r.columnCount,t.colspan,t.rowspan);let o=r.columnCount,s=r.type===`resize`,c=r.itemId;y(a,null,i,()=>b(a,o,s?()=>n?.updateItemSize(c,{width:t.colspan,height:t.rowspan}):void 0)),p=null},w=()=>{if(!p)return;let e=Array.from(p.originals.values()),t=()=>y(e,null,!1);`startViewTransition`in document?document.startViewTransition(t):t(),p=null},T=()=>{if(!p||p.type!==`drag`)return;let t=p.pendingCell;if(!t&&p.element){let e=p.element.getBoundingClientRect();t=g.getCellFromPoint(e.left+e.width/2,e.top+e.height/2)}if(!t)return;p.pendingCell=null;let n=h(_(p.itemId,p.originals),p.itemId,t,p.columnCount);if(y(n,p.itemId,!0),e===`reorder`){let e=n.find(e=>e.id===p.itemId);if(e){let t={cell:{column:e.column,row:e.row},colspan:e.width,rowspan:e.height};queueMicrotask(()=>s.dispatchEvent(new CustomEvent(`egg-drop-preview`,{detail:t,bubbles:!0})))}}},E={"egg-drag-start":x,"egg-drag-move":S,"egg-drag-end":C,"egg-drag-cancel":w,"egg-resize-start":x,"egg-resize-move":S,"egg-resize-end":C,"egg-resize-cancel":w,"egg-camera-settled":T};for(let[e,t]of Object.entries(E))s.addEventListener(e,t);l.push(()=>{for(let[e,t]of Object.entries(E))s.removeEventListener(e,t)})}if(c.camera!==!1){let e=typeof c.camera==`object`?c.camera:{},t=e.edgeSize??60,n=e.scrollSpeed??15,r=e.settleDelay??150,i=window,a=s.parentElement;for(;a;){let e=getComputedStyle(a);if(e.overflowY===`auto`||e.overflowY===`scroll`||e.overflowX===`auto`||e.overflowX===`scroll`){i=a;break}a=a.parentElement}let o=!1,u=null,d=0,f=0,p=null,m=null,h=!1;function _(e){e?(g.cameraScrolling=!0,m&&=(clearTimeout(m),null)):(m&&clearTimeout(m),m=setTimeout(()=>{g.cameraScrolling=!1,m=null,s.dispatchEvent(new CustomEvent(`egg-camera-settled`,{bubbles:!0}))},r))}function v(){if(!o){p=null,h&&=(_(!1),!1);return}let e=i===window?{top:0,left:0,width:window.innerWidth,height:window.innerHeight}:(()=>{let e=i.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}})(),r=d-e.left,a=f-e.top,s=0,c=0;r<t?s=-n*(1-r/t):r>e.width-t&&(s=n*(1-(e.width-r)/t)),a<t?c=-n*(1-a/t):a>e.height-t&&(c=n*(1-(e.height-a)/t)),s||c?(h||_(!0),h=!0,i===window?window.scrollBy(s,c):(i.scrollLeft+=s,i.scrollTop+=c)):h&&=(_(!1),!1),p=requestAnimationFrame(v)}let y=e=>{o&&(d=e.clientX,f=e.clientY,p===null&&(p=requestAnimationFrame(v)))},b=()=>{p!==null&&(cancelAnimationFrame(p),p=null),_(!1)},x={"egg-drag-start":(e=>{o=!0,u=e.detail.source,u===`pointer`&&window.addEventListener(`pointermove`,y)}),"egg-drag-move":(e=>{e.detail.source===`pointer`?(d=e.detail.x,f=e.detail.y):requestAnimationFrame(()=>e.detail.item.scrollIntoView({behavior:`smooth`,block:`nearest`,inline:`nearest`}))}),"egg-drag-end":(e=>{let t=u===`pointer`;o=!1,u=null,b(),t&&window.removeEventListener(`pointermove`,y),t||setTimeout(()=>requestAnimationFrame(()=>e.detail.item.scrollIntoView({behavior:`smooth`,block:`nearest`,inline:`nearest`})),100)}),"egg-drag-cancel":(()=>{let e=u===`pointer`;o=!1,u=null,b(),e&&window.removeEventListener(`pointermove`,y)}),"egg-select":(e=>{o||e.detail.item.scrollIntoView({behavior:`smooth`,block:`nearest`,inline:`nearest`})})};for(let[e,t]of Object.entries(x))s.addEventListener(e,t);l.push(()=>{b();for(let[e,t]of Object.entries(x))s.removeEventListener(e,t)})}if(c.placeholder!==!1){let e=(typeof c.placeholder==`object`?c.placeholder:{}).className??`egg-placeholder`,t=null;function n(){t||(t=document.createElement(`div`),t.className=e,t.style.pointerEvents=`none`,t.style.viewTransitionName=`none`,s.appendChild(t))}function r(e,n,r,i){t&&(t.style.gridColumn=`${e} / span ${r}`,t.style.gridRow=`${n} / span ${i}`)}function i(){t&&=(t.remove(),null)}let a={"egg-drag-start":(e=>{n(),r(e.detail.cell.column,e.detail.cell.row,e.detail.colspan,e.detail.rowspan)}),"egg-drag-move":(e=>{r(e.detail.cell.column,e.detail.cell.row,e.detail.colspan,e.detail.rowspan)}),"egg-drop-preview":(e=>{r(e.detail.cell.column,e.detail.cell.row,e.detail.colspan,e.detail.rowspan)}),"egg-drag-end":(()=>i()),"egg-drag-cancel":(()=>i()),"egg-resize-start":(e=>{n(),r(e.detail.cell.column,e.detail.cell.row,e.detail.colspan,e.detail.rowspan)}),"egg-resize-move":(e=>{r(e.detail.cell.column,e.detail.cell.row,e.detail.colspan,e.detail.rowspan)}),"egg-resize-end":(()=>i()),"egg-resize-cancel":(()=>i())};for(let[e,t]of Object.entries(a))s.addEventListener(e,t);document.addEventListener(`pointerup`,()=>requestAnimationFrame(()=>{t&&!document.querySelector(`[data-egg-dragging]`)&&!document.querySelector(`[data-egg-resizing]`)&&i()})),l.push(()=>{i();for(let[e,t]of Object.entries(a))s.removeEventListener(e,t)})}if(c.accessibility!==!1){let e=document.createElement(`div`);e.setAttribute(`aria-live`,`assertive`),e.setAttribute(`aria-atomic`,`true`),Object.assign(e.style,{position:`absolute`,width:`1px`,height:`1px`,padding:`0`,margin:`-1px`,overflow:`hidden`,clip:`rect(0,0,0,0)`,whiteSpace:`nowrap`,border:`0`}),s.appendChild(e);let t=null,n=null;function r(t){e.textContent=``,requestAnimationFrame(()=>{e.textContent=t})}function i(e){return e.getAttribute(`data-egg-label`)||e.getAttribute(`aria-label`)||e.id||`Item`}function a(e){return`row ${e.row}, column ${e.column}`}function o(e,t,n,r){let i=e.getAttribute(`data-egg-announce-${t}`)||s.getAttribute(`data-egg-announce-${t}`);return i?i.replace(/\{(\w+)\}/g,(e,t)=>n[t]??``):r}let c={"egg-drag-start":(e=>{t=e.detail.cell;let n=i(e.detail.item),s=a(e.detail.cell);r(o(e.detail.item,`grab`,{label:n,row:String(e.detail.cell.row),column:String(e.detail.cell.column)},`${n} grabbed. Position ${s}. Use arrow keys to move, Enter to drop, Escape to cancel.`))}),"egg-drag-move":(e=>{let n=e.detail.cell;t&&n.row===t.row&&n.column===t.column||(t=n,r(o(e.detail.item,`move`,{label:i(e.detail.item),row:String(n.row),column:String(n.column)},`Moved to ${a(n)}.`)))}),"egg-drag-end":(e=>{t=null;let n=i(e.detail.item),s=a(e.detail.cell);r(o(e.detail.item,`drop`,{label:n,row:String(e.detail.cell.row),column:String(e.detail.cell.column)},`${n} dropped at ${s}.`))}),"egg-drag-cancel":(e=>{t=null,r(o(e.detail.item,`cancel`,{label:i(e.detail.item)},`${i(e.detail.item)} drag cancelled.`))}),"egg-resize-start":(e=>{n={colspan:e.detail.colspan,rowspan:e.detail.rowspan};let t=`${e.detail.colspan} columns by ${e.detail.rowspan} rows`;r(o(e.detail.item,`resize-start`,{label:i(e.detail.item),colspan:String(e.detail.colspan),rowspan:String(e.detail.rowspan)},`${i(e.detail.item)} resize started. Size ${t}.`))}),"egg-resize-move":(e=>{n&&e.detail.colspan===n.colspan&&e.detail.rowspan===n.rowspan||(n={colspan:e.detail.colspan,rowspan:e.detail.rowspan},r(o(e.detail.item,`resize-move`,{label:i(e.detail.item),colspan:String(e.detail.colspan),rowspan:String(e.detail.rowspan)},`Resized to ${e.detail.colspan} columns by ${e.detail.rowspan} rows.`)))}),"egg-resize-end":(e=>{n=null;let t=`${e.detail.colspan} columns by ${e.detail.rowspan} rows`;r(o(e.detail.item,`resize-end`,{label:i(e.detail.item),colspan:String(e.detail.colspan),rowspan:String(e.detail.rowspan),row:String(e.detail.cell.row),column:String(e.detail.cell.column)},`${i(e.detail.item)} resized to ${t} at ${a(e.detail.cell)}.`))}),"egg-resize-cancel":(e=>{n=null,r(o(e.detail.item,`resize-cancel`,{label:i(e.detail.item)},`${i(e.detail.item)} resize cancelled.`))})};for(let[e,t]of Object.entries(c))s.addEventListener(e,t);l.push(()=>{e.remove();for(let[e,t]of Object.entries(c))s.removeEventListener(e,t)})}if(c.responsive){let{layoutModel:e}=c.responsive,t=c.responsive.cellSize,n=c.responsive.gap;function r(){if(t!==void 0&&n!==void 0)return;let e=getComputedStyle(s);if(n===void 0&&(n=parseFloat(e.columnGap)||parseFloat(e.gap)||16),t===void 0){let n=parseFloat(e.gridAutoRows);t=n>0?n:parseFloat(e.gridTemplateColumns.split(` `)[0]??`184`)||184}}function i(){r();let i=s.id?`#${s.id}`:s.className?`.${s.className.split(` `)[0]}`:`.grid`;g.baseCSS=e.generateAllBreakpointCSS({cellSize:t,gap:n,gridSelector:i}),g.commitStyles()}g.baseCSS.trim()||i();let a=e.subscribe(()=>i()),o=e.currentColumnCount,u=new ResizeObserver(()=>{let t=getComputedStyle(s),n=Math.max(1,t.gridTemplateColumns.split(` `).filter(Boolean).length);if(n!==o){let t=o;o=n,e.setCurrentColumnCount(n),s.dispatchEvent(new CustomEvent(`egg-column-count-change`,{bubbles:!0,detail:{previousCount:t,currentCount:n}}))}});u.observe(s),l.push(()=>{u.disconnect(),a()})}return!c.responsive&&!g.baseCSS&&(g.baseCSS=a(o(s)),g.commitStyles(),s.querySelectorAll(`[data-egg-item]`).forEach(e=>{e.style.removeProperty(`grid-column`),e.style.removeProperty(`grid-row`)})),g}export{u as calculatePushLayout,f as calculateReorderLayout,l as compactUp,n as getItemCell,i as getItemId,r as getItemSize,p as init,s as itemsOverlap,a as layoutToCSS,c as pushDown,o as readItemsFromDOM,d as reflowItems};
//# sourceMappingURL=eg-grid-condensed.min.js.map