{"version":3,"file":"eg-grid-element.min.js","names":[],"sources":["../src/eg-grid.ts","../src/layout-model.ts","../src/eg-grid-element.ts","../src/bundles/element.ts"],"sourcesContent":["// EG Grid — zero-dependency CSS Grid drag-and-drop\n// Copy this file into your project and tweak as needed.\n// Optionally import { createLayoutModel } from './layout-model' for responsive breakpoint support.\n\n// ── Types ──────────────────────────────────────────────────────────────────────\n\ntype GridCell = { column: number; row: number }\ntype ItemRect = { id: string; column: number; row: number; width: number; height: number }\ntype ResizeHandle = 'nw' | 'ne' | 'sw' | 'se' | 'n' | 's' | 'e' | 'w'\n\ninterface EggCore {\n\telement: HTMLElement\n\tphase: 'idle' | 'selected' | 'interacting'\n\tinteraction: { type: 'drag' | 'resize'; mode: 'pointer' | 'keyboard'; itemId: string; element: HTMLElement; columnCount: number } | null\n\tselectedItem: HTMLElement | null\n\tcameraScrolling: boolean\n\tselect(item: HTMLElement | null): void\n\tdeselect(): void\n\tgetCellFromPoint(x: number, y: number): GridCell | null\n\tgetGridInfo(): { rect: DOMRect; columns: number[]; rows: number[]; gap: number; cellWidth: number; cellHeight: number }\n\temit(event: string, detail: any): void\n\tcommitStyles(): void\n\tbaseCSS: string\n\tpreviewCSS: string\n\tdestroy(): void\n}\n\ninterface InitOptions {\n\talgorithm?: 'push' | false\n\tcompaction?: boolean\n\tresize?: { handles?: 'corners' | 'edges' | 'all'; handleSize?: number; minSize?: { colspan: number; rowspan: number }; maxSize?: { colspan: number; rowspan: number }; showSizeLabel?: boolean } | false\n\tcamera?: { edgeSize?: number; scrollSpeed?: number; scrollMargin?: number; settleDelay?: number } | false\n\tplaceholder?: { className?: string } | false\n\taccessibility?: false\n\tpointer?: false\n\tkeyboard?: false\n\tresponsive?: { layoutModel: ResponsiveLayoutModel; cellSize?: number; gap?: number }\n\tlayoutModel?: ResponsiveLayoutModel\n\tstyleElement?: HTMLStyleElement\n}\n\n// The responsive layout model interface — see layout-model.ts for implementation\ninterface ResponsiveLayoutModel {\n\treadonly maxColumns: number\n\treadonly currentColumnCount: number\n\tgetLayoutForColumns(columnCount: number): Map<string, { column: number; row: number }>\n\tsaveLayout(columnCount: number, positions: Map<string, { column: number; row: number }>): void\n\tupdateItemSize(itemId: string, size: { width: number; height: number }): void\n\tsetCurrentColumnCount(columnCount: number): void\n\tgenerateAllBreakpointCSS(options: { cellSize: number; gap: number; gridSelector?: string }): string\n\tsubscribe(callback: () => void): () => void\n}\n\n// ── Grid Measurement ───────────────────────────────────────────────────────────\n\nfunction parseGridTemplate(template: string): number[] {\n\treturn template.split(' ').filter(Boolean).map(v => parseFloat(v) || 0)\n}\n\nfunction getGridIndex(pos: number, tracks: number[], gap: number): number {\n\tlet acc = 0\n\tconst halfGap = gap / 2\n\tfor (let i = 0; i < tracks.length; i++) {\n\t\tif (pos <= acc + tracks[i]! + halfGap) return i + 1\n\t\tacc += tracks[i]! + gap\n\t}\n\treturn tracks.length || 1\n}\n\nfunction getItemCell(item: HTMLElement): GridCell {\n\tconst s = getComputedStyle(item)\n\treturn { column: parseInt(s.gridColumnStart, 10) || 1, row: parseInt(s.gridRowStart, 10) || 1 }\n}\n\nfunction getItemSize(item: HTMLElement): { colspan: number; rowspan: number } {\n\treturn {\n\t\tcolspan: parseInt(item.getAttribute('data-egg-colspan') || '1', 10) || 1,\n\t\trowspan: parseInt(item.getAttribute('data-egg-rowspan') || '1', 10) || 1,\n\t}\n}\n\nfunction getItemId(el: HTMLElement): string {\n\treturn el.dataset.eggItem || el.dataset.id || el.id || ''\n}\n\n// ── Layout Algorithms ──────────────────────────────────────────────────────────\n\n// Shared\n\nfunction layoutToCSS(items: ItemRect[], opts: { selectorPrefix?: string; selectorSuffix?: string; excludeId?: string; maxColumns?: number } = {}): string {\n\tconst { selectorPrefix = '[data-egg-item=\"', selectorSuffix = '\"]', excludeId, maxColumns } = opts\n\tconst rules: string[] = []\n\tfor (const item of items) {\n\t\tif (item.id === excludeId) continue\n\t\tconst w = maxColumns ? Math.min(item.width, maxColumns) : item.width\n\t\tconst c = maxColumns ? Math.max(1, Math.min(item.column, maxColumns - w + 1)) : item.column\n\t\trules.push(`${selectorPrefix}${item.id}${selectorSuffix} { grid-column: ${c} / span ${w}; grid-row: ${item.row} / span ${item.height}; }`)\n\t}\n\treturn rules.join('\\n')\n}\n\nfunction readItemsFromDOM(container: HTMLElement): ItemRect[] {\n\treturn Array.from(container.querySelectorAll('[data-egg-item]')).map(el => {\n\t\tconst element = el as HTMLElement\n\t\tconst style = getComputedStyle(element)\n\t\treturn {\n\t\t\tid: getItemId(element),\n\t\t\tcolumn: parseInt(style.gridColumnStart, 10) || 1,\n\t\t\trow: parseInt(style.gridRowStart, 10) || 1,\n\t\t\twidth: parseInt(element.getAttribute('data-egg-colspan') || '1', 10) || 1,\n\t\t\theight: parseInt(element.getAttribute('data-egg-rowspan') || '1', 10) || 1,\n\t\t}\n\t})\n}\n\n// Push algorithm\n\nfunction itemsOverlap(a: ItemRect, b: ItemRect): boolean {\n\treturn !(a.column + a.width <= b.column || b.column + b.width <= a.column || a.row + a.height <= b.row || b.row + b.height <= a.row)\n}\n\nfunction pushDown(items: ItemRect[], moved: ItemRect, movedId: string, depth = 0): void {\n\tif (depth > 50) return\n\tconst colliders = items\n\t\t.filter(it => it.id !== movedId && it.id !== moved.id && itemsOverlap(moved, it))\n\t\t.sort((a, b) => b.row - a.row || a.column - b.column)\n\tfor (const c of colliders) {\n\t\tconst newRow = moved.row + moved.height\n\t\tif (c.row < newRow) {\n\t\t\tc.row = newRow\n\t\t\tpushDown(items, c, movedId, depth + 1)\n\t\t}\n\t}\n}\n\nfunction compactUp(items: ItemRect[], excludeId: string): void {\n\tconst sorted = [...items].filter(it => it.id !== excludeId).sort((a, b) => a.row - b.row || a.column - b.column)\n\tfor (const item of sorted) {\n\t\tlet iter = 0\n\t\twhile (item.row > 1 && iter++ < 100) {\n\t\t\titem.row -= 1\n\t\t\tif (items.some(o => o.id !== item.id && itemsOverlap(item, o))) { item.row += 1; break }\n\t\t}\n\t}\n}\n\nfunction calculatePushLayout(items: ItemRect[], movedId: string, targetCell: GridCell, compact = true): ItemRect[] {\n\tconst result = items.map(i => ({ ...i }))\n\tconst moved = result.find(i => i.id === movedId)\n\tif (!moved) return result\n\tmoved.column = targetCell.column\n\tmoved.row = targetCell.row\n\tpushDown(result, moved, movedId)\n\tif (compact) compactUp(result, movedId)\n\treturn result\n}\n\n// ── init() ─────────────────────────────────────────────────────────────────────\n\nexport function init(element: HTMLElement, options: InitOptions = {}): EggCore {\n\tconst cleanups: (() => void)[] = []\n\tconst styleEl = options.styleElement ?? document.createElement('style')\n\tif (!options.styleElement) { document.head.appendChild(styleEl); cleanups.push(() => styleEl.remove()) }\n\n\tconst existingCSS = styleEl.textContent?.trim() || ''\n\tlet selectedElement: HTMLElement | null = null\n\n\tconst core: EggCore = {\n\t\telement,\n\t\tphase: 'idle',\n\t\tinteraction: null,\n\t\tcameraScrolling: false,\n\t\tbaseCSS: existingCSS,\n\t\tpreviewCSS: '',\n\n\t\tget selectedItem() { return selectedElement },\n\t\tset selectedItem(item) { this.select(item) },\n\n\t\tselect(item) {\n\t\t\tif (item === selectedElement) return\n\t\t\tconst prev = selectedElement\n\t\t\tif (prev) prev.removeAttribute('data-egg-selected')\n\t\t\tif (item) {\n\t\t\t\tthis.phase = this.phase === 'idle' ? 'selected' : this.phase\n\t\t\t\tselectedElement = item\n\t\t\t\titem.setAttribute('data-egg-selected', '')\n\t\t\t\tthis.emit('select', { item })\n\t\t\t} else {\n\t\t\t\tif (this.phase === 'selected') this.phase = 'idle'\n\t\t\t\tselectedElement = null\n\t\t\t\tif (prev) this.emit('deselect', { item: prev })\n\t\t\t}\n\t\t},\n\n\t\tdeselect() { this.select(null) },\n\n\t\tgetCellFromPoint(x, y) {\n\t\t\tconst rect = element.getBoundingClientRect()\n\t\t\tif (x < rect.left || x > rect.right || y < rect.top || y > rect.bottom) return null\n\t\t\tconst s = getComputedStyle(element)\n\t\t\tconst cols = parseGridTemplate(s.gridTemplateColumns)\n\t\t\tconst rows = parseGridTemplate(s.gridTemplateRows)\n\t\t\tconst cGap = parseFloat(s.columnGap) || 0\n\t\t\tconst rGap = parseFloat(s.rowGap) || 0\n\t\t\treturn {\n\t\t\t\tcolumn: getGridIndex(x - rect.left + element.scrollLeft, cols, cGap),\n\t\t\t\trow: getGridIndex(y - rect.top + element.scrollTop, rows, rGap),\n\t\t\t}\n\t\t},\n\n\t\tgetGridInfo() {\n\t\t\tconst rect = element.getBoundingClientRect()\n\t\t\tconst s = getComputedStyle(element)\n\t\t\tconst columns = parseGridTemplate(s.gridTemplateColumns)\n\t\t\tconst rows = parseGridTemplate(s.gridTemplateRows)\n\t\t\tconst gap = parseFloat(s.columnGap) || 0\n\t\t\treturn { rect, columns, rows, gap, cellWidth: columns[0] || 0, cellHeight: rows[0] || 0 }\n\t\t},\n\n\t\temit(event, detail) {\n\t\t\telement.dispatchEvent(new CustomEvent(`egg-${event}`, { bubbles: true, detail }))\n\t\t},\n\n\t\tcommitStyles() {\n\t\t\tstyleEl.textContent = [this.baseCSS, this.previewCSS].filter(Boolean).join('\\n\\n')\n\t\t},\n\n\t\tdestroy() { cleanups.forEach(fn => fn()) },\n\t}\n\n\t// ── Pointer ────────────────────────────────────────────────────────────────\n\n\tif (options.pointer !== false) {\n\t\tconst DRAG_THRESHOLD = 5\n\t\tconst PREDICTION_THRESHOLD = 30\n\t\tconst PREDICTION_LEAD = 0.5\n\t\tconst HYSTERESIS = 0.4\n\t\tconst TARGET_DEBOUNCE = 40\n\n\t\tlet pending: { item: HTMLElement; pointerId: number; startX: number; startY: number; rect: DOMRect; startCell: GridCell; colspan: number; rowspan: number } | null = null\n\t\tlet drag: { item: HTMLElement; pointerId: number; offsetX: number; offsetY: number; initialRect: DOMRect; startCell: GridCell; lastCell: GridCell; lastChangeTime: number; colspan: number; rowspan: number; dragStartX: number; dragStartY: number } | null = null\n\n\t\tfunction startDrag(p: NonNullable<typeof pending>, e: PointerEvent) {\n\t\t\tconst { item, pointerId, rect, startCell, colspan, rowspan } = p\n\t\t\tdrag = {\n\t\t\t\titem, pointerId, offsetX: e.clientX - rect.left, offsetY: e.clientY - rect.top,\n\t\t\t\tinitialRect: rect, startCell, lastCell: startCell, lastChangeTime: 0, colspan, rowspan,\n\t\t\t\tdragStartX: e.clientX, dragStartY: e.clientY,\n\t\t\t}\n\t\t\titem.setAttribute('data-egg-dragging', '')\n\t\t\tdocument.body.classList.add('is-dragging')\n\t\t\tconst itemId = getItemId(item)\n\t\t\tcore.phase = 'interacting'\n\t\t\tcore.interaction = { type: 'drag', mode: 'pointer', itemId, element: item, columnCount: core.getGridInfo().columns.length }\n\t\t\tcore.emit('drag-start', { item, cell: startCell, colspan, rowspan, source: 'pointer' })\n\t\t\titem.style.position = 'fixed'\n\t\t\titem.style.left = `${rect.left}px`\n\t\t\titem.style.top = `${rect.top}px`\n\t\t\titem.style.width = `${rect.width}px`\n\t\t\titem.style.height = `${rect.height}px`\n\t\t\titem.style.zIndex = '100'\n\t\t\tpending = null\n\t\t}\n\n\t\tconst onPointerMove = (e: PointerEvent) => {\n\t\t\tif (pending && !drag) {\n\t\t\t\tconst dx = e.clientX - pending.startX, dy = e.clientY - pending.startY\n\t\t\t\tif (Math.sqrt(dx * dx + dy * dy) >= DRAG_THRESHOLD) startDrag(pending, e)\n\t\t\t\telse return\n\t\t\t}\n\t\t\tif (!drag) return\n\t\t\tconst { item, offsetX, offsetY, initialRect, colspan, rowspan } = drag\n\t\t\tconst newLeft = e.clientX - offsetX, newTop = e.clientY - offsetY\n\t\t\titem.style.left = `${newLeft}px`\n\t\t\titem.style.top = `${newTop}px`\n\n\t\t\tlet cx = newLeft + initialRect.width / 2, cy = newTop + initialRect.height / 2\n\t\t\tconst gi = core.getGridInfo()\n\t\t\tconst cdx = e.clientX - drag.dragStartX, cdy = e.clientY - drag.dragStartY\n\t\t\tif (Math.abs(cdx) > PREDICTION_THRESHOLD) cx += Math.sign(cdx) * PREDICTION_LEAD * (gi.cellWidth + gi.gap)\n\t\t\tif (Math.abs(cdy) > PREDICTION_THRESHOLD) cy += Math.sign(cdy) * PREDICTION_LEAD * (gi.cellHeight + gi.gap)\n\n\t\t\tconst rawCell = core.getCellFromPoint(cx, cy)\n\t\t\tif (!rawCell) return\n\t\t\tconst maxCol = Math.max(1, gi.columns.length - colspan + 1)\n\t\t\tconst maxRow = Math.max(1, gi.rows.length - rowspan + 1)\n\t\t\tconst cell = { column: Math.max(1, Math.min(maxCol, rawCell.column)), row: Math.max(1, Math.min(maxRow, rawCell.row)) }\n\n\t\t\tconst now = performance.now()\n\t\t\tif (now - drag.lastChangeTime < TARGET_DEBOUNCE) return\n\t\t\tif (cell.column === drag.lastCell.column && cell.row === drag.lastCell.row) return\n\n\t\t\t// Hysteresis\n\t\t\tconst cellW = gi.cellWidth + gi.gap, cellH = gi.cellHeight + gi.gap\n\t\t\tconst ccx = gi.rect.left + (drag.lastCell.column - 1) * cellW + gi.cellWidth / 2\n\t\t\tconst ccy = gi.rect.top + (drag.lastCell.row - 1) * cellH + gi.cellHeight / 2\n\t\t\tconst offX = (cx - ccx) / cellW, offY = (cy - ccy) / cellH\n\t\t\tconst alignedX = (cell.column > drag.lastCell.column) === (offX > 0)\n\t\t\tconst alignedY = (cell.row > drag.lastCell.row) === (offY > 0)\n\t\t\tif (Math.abs(offX) < (alignedX ? 0.5 : 0.5 + HYSTERESIS) && Math.abs(offY) < (alignedY ? 0.5 : 0.5 + HYSTERESIS)) return\n\n\t\t\tdrag.lastCell = cell\n\t\t\tdrag.lastChangeTime = now\n\t\t\tcore.emit('drag-move', { item, cell, x: e.clientX, y: e.clientY, colspan, rowspan, source: 'pointer' })\n\t\t}\n\n\t\tconst cleanupDrag = () => {\n\t\t\tif (drag) {\n\t\t\t\tconst { item, pointerId } = drag\n\t\t\t\titem.removeAttribute('data-egg-dragging')\n\t\t\t\tdocument.body.classList.remove('is-dragging')\n\t\t\t\titem.style.position = ''; item.style.left = ''; item.style.top = ''\n\t\t\t\titem.style.width = ''; item.style.height = ''; item.style.zIndex = ''\n\t\t\t\titem.releasePointerCapture(pointerId)\n\t\t\t\titem.removeEventListener('pointermove', onPointerMove)\n\t\t\t\titem.removeEventListener('pointerup', onPointerUp)\n\t\t\t\titem.removeEventListener('pointercancel', onPointerCancel)\n\t\t\t\tdrag = null\n\t\t\t}\n\t\t\tif (pending) {\n\t\t\t\tpending.item.releasePointerCapture(pending.pointerId)\n\t\t\t\tpending.item.removeEventListener('pointermove', onPointerMove)\n\t\t\t\tpending.item.removeEventListener('pointerup', onPointerUp)\n\t\t\t\tpending.item.removeEventListener('pointercancel', onPointerCancel)\n\t\t\t\tpending = null\n\t\t\t}\n\t\t}\n\n\t\tconst onPointerUp = (e: PointerEvent) => {\n\t\t\tif (pending && !drag) { cleanupDrag(); return }\n\t\t\tif (!drag) return\n\n\t\t\tconst { item, initialRect, colspan, rowspan, lastCell, offsetX, offsetY, dragStartX, dragStartY } = drag\n\t\t\tconst gi = core.getGridInfo()\n\t\t\tconst cdx = e.clientX - dragStartX, cdy = e.clientY - dragStartY\n\t\t\tconst nL = e.clientX - offsetX, nT = e.clientY - offsetY\n\t\t\tlet ecx = nL + initialRect.width / 2, ecy = nT + initialRect.height / 2\n\t\t\tif (Math.abs(cdx) > PREDICTION_THRESHOLD) ecx += Math.sign(cdx) * PREDICTION_LEAD * (gi.cellWidth + gi.gap)\n\t\t\tif (Math.abs(cdy) > PREDICTION_THRESHOLD) ecy += Math.sign(cdy) * PREDICTION_LEAD * (gi.cellHeight + gi.gap)\n\n\t\t\tconst rawCell = core.getCellFromPoint(ecx, ecy)\n\t\t\tconst firstRect = item.getBoundingClientRect()\n\n\t\t\tlet dropCell = lastCell\n\t\t\tif (rawCell) {\n\t\t\t\tconst maxCol = Math.max(1, gi.columns.length - colspan + 1)\n\t\t\t\tconst maxRow = Math.max(1, gi.rows.length - rowspan + 1)\n\t\t\t\tdropCell = { column: Math.max(1, Math.min(maxCol, rawCell.column)), row: Math.max(1, Math.min(maxRow, rawCell.row)) }\n\t\t\t}\n\n\t\t\tcore.emit('drag-end', { item, cell: dropCell, colspan, rowspan, source: 'pointer' })\n\t\t\tcleanupDrag()\n\t\t\tcore.phase = 'selected'\n\t\t\tcore.interaction = null\n\n\t\t\t// Inline FLIP animation\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst lastRect = item.getBoundingClientRect()\n\t\t\t\tconst dx = firstRect.left - lastRect.left, dy = firstRect.top - lastRect.top\n\t\t\t\tif (Math.abs(dx) > 1 || Math.abs(dy) > 1) {\n\t\t\t\t\titem.style.viewTransitionName = 'none'\n\t\t\t\t\titem.setAttribute('data-egg-dropping', '')\n\t\t\t\t\tconst anim = item.animate(\n\t\t\t\t\t\t[{ transform: `translate(${dx}px, ${dy}px)` }, { transform: 'none' }],\n\t\t\t\t\t\t{ duration: 200, easing: 'cubic-bezier(0.2, 0, 0, 1)' },\n\t\t\t\t\t)\n\t\t\t\t\tanim.onfinish = () => {\n\t\t\t\t\t\titem.removeAttribute('data-egg-dropping')\n\t\t\t\t\t\tconst id = getItemId(item)\n\t\t\t\t\t\titem.style.viewTransitionName = id || ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tconst onPointerCancel = () => {\n\t\t\tif (drag) {\n\t\t\t\tcore.emit('drag-cancel', { item: drag.item, source: 'pointer' })\n\t\t\t\tcore.phase = 'selected'\n\t\t\t\tcore.interaction = null\n\t\t\t}\n\t\t\tcleanupDrag()\n\t\t}\n\n\t\tconst onPointerDown = (e: PointerEvent) => {\n\t\t\tconst item = (e.target as HTMLElement).closest('[data-egg-item]') as HTMLElement | null\n\t\t\tif (!item) return\n\t\t\tcore.select(item)\n\t\t\te.preventDefault()\n\t\t\tconst rect = item.getBoundingClientRect()\n\t\t\tpending = { item, pointerId: e.pointerId, startX: e.clientX, startY: e.clientY, rect, startCell: getItemCell(item), ...getItemSize(item) }\n\t\t\titem.setPointerCapture(e.pointerId)\n\t\t\titem.addEventListener('pointermove', onPointerMove)\n\t\t\titem.addEventListener('pointerup', onPointerUp)\n\t\t\titem.addEventListener('pointercancel', onPointerCancel)\n\t\t}\n\n\t\tconst onDocPointerDown = (e: PointerEvent) => {\n\t\t\tif (element.contains(e.target as Node) || drag) return\n\t\t\tcore.deselect()\n\t\t}\n\n\t\telement.addEventListener('pointerdown', onPointerDown)\n\t\tdocument.addEventListener('pointerdown', onDocPointerDown)\n\t\tcleanups.push(() => { element.removeEventListener('pointerdown', onPointerDown); document.removeEventListener('pointerdown', onDocPointerDown); cleanupDrag() })\n\t}\n\n\t// ── Resize ─────────────────────────────────────────────────────────────────\n\n\tif (options.resize !== false) {\n\t\tconst resizeOpts = typeof options.resize === 'object' ? options.resize : {}\n\t\tconst handles = resizeOpts.handles ?? 'corners'\n\t\tconst handleSize = resizeOpts.handleSize ?? 12\n\t\tconst minSize = resizeOpts.minSize ?? { colspan: 1, rowspan: 1 }\n\t\tconst maxSize = resizeOpts.maxSize ?? { colspan: 6, rowspan: 6 }\n\t\tconst showSizeLabel = resizeOpts.showSizeLabel ?? true\n\n\t\tconst CURSOR: Record<string, string> = { nw: 'nwse-resize', se: 'nwse-resize', ne: 'nesw-resize', sw: 'nesw-resize', n: 'ns-resize', s: 'ns-resize', e: 'ew-resize', w: 'ew-resize' }\n\n\t\tlet active: {\n\t\t\titem: HTMLElement; pointerId: number; handle: ResizeHandle; startCell: GridCell\n\t\t\torigSize: { colspan: number; rowspan: number }; curCell: GridCell; curSize: { colspan: number; rowspan: number }\n\t\t\tsizeLabel: HTMLElement | null; initRect: DOMRect; startX: number; startY: number\n\t\t} | null = null\n\t\tlet hoveredItem: HTMLElement | null = null\n\t\tlet hoveredHandle: ResizeHandle | null = null\n\n\t\tfunction detectHandle(e: PointerEvent, item: HTMLElement): ResizeHandle | null {\n\t\t\tconst r = item.getBoundingClientRect()\n\t\t\tconst x = e.clientX - r.left, y = e.clientY - r.top\n\t\t\tconst nL = x < handleSize, nR = x > r.width - handleSize, nT = y < handleSize, nB = y > r.height - handleSize\n\t\t\tif (handles === 'corners' || handles === 'all') {\n\t\t\t\tif (nT && nL) return 'nw'; if (nT && nR) return 'ne'; if (nB && nL) return 'sw'; if (nB && nR) return 'se'\n\t\t\t}\n\t\t\tif (handles === 'edges' || handles === 'all') {\n\t\t\t\tif (nT) return 'n'; if (nB) return 's'; if (nL) return 'w'; if (nR) return 'e'\n\t\t\t}\n\t\t\treturn null\n\t\t}\n\n\t\tfunction resetResizeItem(item: HTMLElement, pointerId: number, label: HTMLElement | null) {\n\t\t\titem.releasePointerCapture(pointerId)\n\t\t\titem.removeEventListener('pointermove', onResizePointerMove)\n\t\t\titem.removeEventListener('pointerup', onResizePointerUp)\n\t\t\titem.removeEventListener('pointercancel', onResizePointerCancel)\n\t\t\tif (label) label.remove()\n\t\t\titem.style.position = ''; item.style.left = ''; item.style.top = ''\n\t\t\titem.style.width = ''; item.style.height = ''; item.style.zIndex = ''\n\t\t\tconst id = getItemId(item)\n\t\t\titem.style.viewTransitionName = id || ''\n\t\t\titem.removeAttribute('data-egg-resizing')\n\t\t\titem.removeAttribute('data-egg-handle-active')\n\t\t}\n\n\t\tconst onResizePointerMove = (e: PointerEvent) => {\n\t\t\tif (!active || e.pointerId !== active.pointerId) return\n\t\t\tconst { item, handle, startCell, origSize, initRect, startX, startY, sizeLabel } = active\n\t\t\tconst gi = core.getGridInfo()\n\t\t\tconst dx = e.clientX - startX, dy = e.clientY - startY\n\n\t\t\tlet nW = initRect.width, nH = initRect.height, nL = initRect.left, nT = initRect.top\n\t\t\tconst minW = gi.cellWidth, minH = gi.cellHeight\n\t\t\tconst maxW = Math.min(maxSize.colspan * gi.cellWidth + (maxSize.colspan - 1) * gi.gap, gi.rect.right - initRect.left)\n\t\t\tconst maxH = Math.min(maxSize.rowspan * gi.cellHeight + (maxSize.rowspan - 1) * gi.gap, gi.rect.bottom - initRect.top)\n\n\t\t\tif (handle === 'e' || handle === 'se' || handle === 'ne') nW = Math.max(minW, Math.min(maxW, initRect.width + dx))\n\t\t\tif (handle === 'w' || handle === 'sw' || handle === 'nw') {\n\t\t\t\tconst maxLS = initRect.left - gi.rect.left\n\t\t\t\tconst maxWL = Math.min(maxSize.colspan * gi.cellWidth + (maxSize.colspan - 1) * gi.gap, initRect.width + maxLS)\n\t\t\t\tconst wc = Math.max(-initRect.width + minW, Math.min(maxWL - initRect.width, -dx))\n\t\t\t\tnW = initRect.width + wc; nL = initRect.left - wc\n\t\t\t}\n\t\t\tif (handle === 's' || handle === 'se' || handle === 'sw') nH = Math.max(minH, Math.min(maxH, initRect.height + dy))\n\t\t\tif (handle === 'n' || handle === 'ne' || handle === 'nw') {\n\t\t\t\tconst maxTS = initRect.top - gi.rect.top\n\t\t\t\tconst maxHL = Math.min(maxSize.rowspan * gi.cellHeight + (maxSize.rowspan - 1) * gi.gap, initRect.height + maxTS)\n\t\t\t\tconst hc = Math.max(-initRect.height + minH, Math.min(maxHL - initRect.height, -dy))\n\t\t\t\tnH = initRect.height + hc; nT = initRect.top - hc\n\t\t\t}\n\t\t\titem.style.left = `${nL}px`; item.style.top = `${nT}px`\n\t\t\titem.style.width = `${nW}px`; item.style.height = `${nH}px`\n\n\t\t\tconst cpg = gi.cellWidth + gi.gap, rpg = gi.cellHeight + gi.gap\n\t\t\tconst SNAP = 0.3\n\t\t\tlet pCS = Math.max(minSize.colspan, Math.min(maxSize.colspan, Math.floor((nW + gi.gap) / cpg + (1 - SNAP))))\n\t\t\tlet pRS = Math.max(minSize.rowspan, Math.min(maxSize.rowspan, Math.floor((nH + gi.gap) / rpg + (1 - SNAP))))\n\t\t\tlet pCol = startCell.column, pRow = startCell.row\n\t\t\tif (handle === 'w' || handle === 'sw' || handle === 'nw') pCol = startCell.column + origSize.colspan - pCS\n\t\t\tif (handle === 'n' || handle === 'ne' || handle === 'nw') pRow = startCell.row + origSize.rowspan - pRS\n\n\t\t\tactive.curSize = { colspan: pCS, rowspan: pRS }\n\t\t\tactive.curCell = { column: pCol, row: pRow }\n\t\t\tif (sizeLabel) sizeLabel.textContent = `${pCS}\\u00d7${pRS}`\n\n\t\t\tlet anchorCell: GridCell\n\t\t\tif (handle === 'se' || handle === 's' || handle === 'e') anchorCell = { column: startCell.column, row: startCell.row }\n\t\t\telse if (handle === 'nw' || handle === 'n' || handle === 'w') anchorCell = { column: startCell.column + origSize.colspan - 1, row: startCell.row + origSize.rowspan - 1 }\n\t\t\telse if (handle === 'ne') anchorCell = { column: startCell.column, row: startCell.row + origSize.rowspan - 1 }\n\t\t\telse anchorCell = { column: startCell.column + origSize.colspan - 1, row: startCell.row }\n\n\t\t\tcore.emit('resize-move', { item, cell: { column: pCol, row: pRow }, anchorCell, startCell, colspan: pCS, rowspan: pRS, handle, source: 'pointer' })\n\t\t}\n\n\t\tconst onResizePointerUp = (e: PointerEvent) => {\n\t\t\tif (!active || e.pointerId !== active.pointerId) return\n\t\t\tconst { item, pointerId, curSize, curCell, sizeLabel } = active\n\t\t\titem.setAttribute('data-egg-colspan', String(curSize.colspan))\n\t\t\titem.setAttribute('data-egg-rowspan', String(curSize.rowspan))\n\t\t\tcore.emit('resize-end', { item, cell: curCell, colspan: curSize.colspan, rowspan: curSize.rowspan, source: 'pointer' })\n\t\t\tresetResizeItem(item, pointerId, sizeLabel)\n\t\t\tactive = null\n\t\t\tcore.phase = 'selected'\n\t\t\tcore.interaction = null\n\t\t}\n\n\t\tconst onResizePointerCancel = (e: PointerEvent) => {\n\t\t\tif (!active || e.pointerId !== active.pointerId) return\n\t\t\tcore.emit('resize-cancel', { item: active.item, source: 'pointer' })\n\t\t\tresetResizeItem(active.item, active.pointerId, active.sizeLabel)\n\t\t\tactive = null\n\t\t\tcore.phase = 'selected'\n\t\t\tcore.interaction = null\n\t\t}\n\n\t\tconst onResizeDown = (e: PointerEvent) => {\n\t\t\tconst item = (e.target as HTMLElement).closest('[data-egg-item]') as HTMLElement | null\n\t\t\tif (!item) return\n\t\t\tconst handle = detectHandle(e, item)\n\t\t\tif (!handle) return\n\t\t\te.stopPropagation(); e.preventDefault()\n\t\t\tcore.select(item)\n\t\t\tconst { colspan, rowspan } = getItemSize(item)\n\t\t\tconst s = getComputedStyle(item)\n\t\t\tconst startCell = { column: parseInt(s.gridColumnStart, 10) || 1, row: parseInt(s.gridRowStart, 10) || 1 }\n\t\t\tconst initRect = item.getBoundingClientRect()\n\t\t\tlet sizeLabel: HTMLElement | null = null\n\t\t\tif (showSizeLabel) {\n\t\t\t\tsizeLabel = document.createElement('div')\n\t\t\t\tsizeLabel.className = 'egg-resize-label'\n\t\t\t\tsizeLabel.style.cssText = 'position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.8);color:white;padding:4px 8px;border-radius:4px;font-size:14px;font-weight:600;font-family:system-ui,sans-serif;pointer-events:none;z-index:1000;white-space:nowrap'\n\t\t\t\tsizeLabel.textContent = `${colspan}\\u00d7${rowspan}`\n\t\t\t\titem.appendChild(sizeLabel)\n\t\t\t}\n\t\t\tactive = { item, pointerId: e.pointerId, handle, startCell, origSize: { colspan, rowspan }, curCell: { ...startCell }, curSize: { colspan, rowspan }, sizeLabel, initRect, startX: e.clientX, startY: e.clientY }\n\t\t\titem.setAttribute('data-egg-resizing', ''); item.setAttribute('data-egg-handle-active', handle); item.removeAttribute('data-egg-handle-hover')\n\t\t\titem.setPointerCapture(e.pointerId)\n\t\t\titem.addEventListener('pointermove', onResizePointerMove)\n\t\t\titem.addEventListener('pointerup', onResizePointerUp)\n\t\t\titem.addEventListener('pointercancel', onResizePointerCancel)\n\t\t\tcore.phase = 'interacting'\n\t\t\tcore.interaction = { type: 'resize', mode: 'pointer', itemId: getItemId(item), element: item, columnCount: core.getGridInfo().columns.length }\n\t\t\tcore.emit('resize-start', { item, cell: startCell, colspan, rowspan, handle, source: 'pointer' })\n\t\t\titem.style.position = 'fixed'; item.style.left = `${initRect.left}px`; item.style.top = `${initRect.top}px`\n\t\t\titem.style.width = `${initRect.width}px`; item.style.height = `${initRect.height}px`; item.style.zIndex = '100'\n\t\t\titem.style.viewTransitionName = 'resizing'\n\t\t}\n\n\t\tconst onResizeHover = (e: PointerEvent) => {\n\t\t\tif (active) return\n\t\t\tconst item = (e.target as HTMLElement).closest('[data-egg-item]') as HTMLElement | null\n\t\t\tif (item) {\n\t\t\t\tconst h = detectHandle(e, item)\n\t\t\t\tif (h !== hoveredHandle || item !== hoveredItem) {\n\t\t\t\t\tif (hoveredItem && hoveredItem !== item) { hoveredItem.style.cursor = ''; hoveredItem.removeAttribute('data-egg-handle-hover') }\n\t\t\t\t\tif (hoveredItem === item && hoveredHandle && !h) item.removeAttribute('data-egg-handle-hover')\n\t\t\t\t\thoveredItem = item; hoveredHandle = h\n\t\t\t\t\titem.style.cursor = (h ? CURSOR[h] : '') || ''\n\t\t\t\t\tif (h) item.setAttribute('data-egg-handle-hover', h); else item.removeAttribute('data-egg-handle-hover')\n\t\t\t\t}\n\t\t\t} else if (hoveredItem) { hoveredItem.style.cursor = ''; hoveredItem.removeAttribute('data-egg-handle-hover'); hoveredItem = null; hoveredHandle = null }\n\t\t}\n\n\t\tconst onResizeEsc = (e: KeyboardEvent) => { if (e.key === 'Escape' && active) { onResizePointerCancel(new PointerEvent('pointercancel', { pointerId: active.pointerId })) } }\n\n\t\telement.addEventListener('pointerdown', onResizeDown, { capture: true })\n\t\telement.addEventListener('pointermove', onResizeHover)\n\t\tdocument.addEventListener('keydown', onResizeEsc)\n\t\tcleanups.push(() => { element.removeEventListener('pointerdown', onResizeDown, { capture: true }); element.removeEventListener('pointermove', onResizeHover); document.removeEventListener('keydown', onResizeEsc) })\n\t}\n\n\t// ── Keyboard ───────────────────────────────────────────────────────────────\n\n\tif (options.keyboard !== false) {\n\t\tlet kbMode = false\n\t\tlet kbTargetCell: GridCell | null = null\n\t\tlet pendingVtnRestore: { item: HTMLElement; tid: number } | null = null\n\n\t\tconst KEY_DIR: Record<string, 'up' | 'down' | 'left' | 'right'> = { ArrowUp: 'up', ArrowDown: 'down', ArrowLeft: 'left', ArrowRight: 'right', k: 'up', K: 'up', j: 'down', J: 'down', h: 'left', H: 'left', l: 'right', L: 'right' }\n\t\tconst CODE_DIR: Record<string, 'up' | 'down' | 'left' | 'right'> = { KeyK: 'up', KeyJ: 'down', KeyH: 'left', KeyL: 'right' }\n\t\tconst getDir = (key: string, code: string) => KEY_DIR[key] ?? CODE_DIR[code] ?? null\n\n\t\tconst isHolding = () => core.phase === 'interacting' && core.interaction?.type === 'drag' && core.interaction.mode === 'keyboard'\n\t\tconst getHeldItem = () => isHolding() ? core.interaction!.element : null\n\n\t\tconst getAdjacentCell = (cell: GridCell, dir: string, amt = 1): GridCell => {\n\t\t\tif (dir === 'up') return { ...cell, row: Math.max(1, cell.row - amt) }\n\t\t\tif (dir === 'down') return { ...cell, row: cell.row + amt }\n\t\t\tif (dir === 'left') return { ...cell, column: Math.max(1, cell.column - amt) }\n\t\t\treturn { ...cell, column: cell.column + amt }\n\t\t}\n\n\t\tconst findItemInDir = (from: GridCell, dir: string, exclude: HTMLElement): HTMLElement | null => {\n\t\t\tconst items = Array.from(element.querySelectorAll('[data-egg-item]')) as HTMLElement[]\n\t\t\tlet best: HTMLElement | null = null, bestDist = Infinity\n\t\t\tfor (const item of items) {\n\t\t\t\tif (item === exclude) continue\n\t\t\t\tconst c = getItemCell(item)\n\t\t\t\tlet inDir = false, dist = 0\n\t\t\t\tif (dir === 'up') { inDir = c.row < from.row; dist = from.row - c.row + Math.abs(c.column - from.column) * 0.1 }\n\t\t\t\telse if (dir === 'down') { inDir = c.row > from.row; dist = c.row - from.row + Math.abs(c.column - from.column) * 0.1 }\n\t\t\t\telse if (dir === 'left') { inDir = c.column < from.column; dist = from.column - c.column + Math.abs(c.row - from.row) * 0.1 }\n\t\t\t\telse { inDir = c.column > from.column; dist = c.column - from.column + Math.abs(c.row - from.row) * 0.1 }\n\t\t\t\tif (inDir && dist < bestDist) { bestDist = dist; best = item }\n\t\t\t}\n\t\t\treturn best\n\t\t}\n\n\t\tconst onKeyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.key === 'G' && e.shiftKey && !e.ctrlKey && !e.altKey && !e.metaKey) {\n\t\t\t\te.preventDefault()\n\t\t\t\tkbMode = !kbMode\n\t\t\t\tif (kbMode) {\n\t\t\t\t\telement.setAttribute('data-egg-keyboard-mode', '')\n\t\t\t\t\tif (!core.selectedItem) { const f = element.querySelector('[data-egg-item]') as HTMLElement | null; if (f) core.select(f) }\n\t\t\t\t} else element.removeAttribute('data-egg-keyboard-mode')\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst focused = document.activeElement as HTMLElement | null\n\t\t\tif (!kbMode && !(focused && element.contains(focused)) && !core.selectedItem) return\n\t\t\tconst sel = core.selectedItem\n\t\t\tconst dir = getDir(e.key, e.code)\n\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\te.preventDefault()\n\t\t\t\tconst held = getHeldItem()\n\t\t\t\tif (held) { held.removeAttribute('data-egg-dragging'); core.emit('drag-cancel', { item: held, source: 'keyboard' }); core.phase = 'selected'; core.interaction = null; kbTargetCell = null }\n\t\t\t\telse if (sel) core.deselect()\n\t\t\t\tif (kbMode) { kbMode = false; element.removeAttribute('data-egg-keyboard-mode') }\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\tif (!sel) return; e.preventDefault()\n\t\t\t\tconst held = getHeldItem()\n\t\t\t\tif (held) {\n\t\t\t\t\tconst tc = kbTargetCell ?? getItemCell(held), sz = getItemSize(held)\n\t\t\t\t\theld.removeAttribute('data-egg-dragging')\n\t\t\t\t\tcore.emit('drag-end', { item: held, cell: tc, colspan: sz.colspan, rowspan: sz.rowspan, source: 'keyboard' })\n\t\t\t\t\tcore.phase = 'selected'; core.interaction = null; kbTargetCell = null\n\t\t\t\t} else {\n\t\t\t\t\tconst itemId = getItemId(sel), sz = getItemSize(sel), sc = getItemCell(sel)\n\t\t\t\t\tcore.phase = 'interacting'\n\t\t\t\t\tcore.interaction = { type: 'drag', mode: 'keyboard', itemId, element: sel, columnCount: core.getGridInfo().columns.length }\n\t\t\t\t\tkbTargetCell = sc\n\t\t\t\t\tsel.setAttribute('data-egg-dragging', '')\n\t\t\t\t\tcore.emit('drag-start', { item: sel, cell: sc, colspan: sz.colspan, rowspan: sz.rowspan, source: 'keyboard' })\n\t\t\t\t}\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (!dir) return\n\t\t\te.preventDefault()\n\n\t\t\tif (e.altKey && !e.ctrlKey && !e.shiftKey && sel) {\n\t\t\t\tconst adj = findItemInDir(getItemCell(sel), dir, sel)\n\t\t\t\tif (adj) core.select(adj)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (!sel) return\n\n\t\t\tconst cc = getItemCell(sel), sz = getItemSize(sel), gi = core.getGridInfo()\n\n\t\t\t// Shift+nav: resize\n\t\t\tif (e.shiftKey && !e.ctrlKey && !e.altKey) {\n\t\t\t\tlet nCS = sz.colspan, nRS = sz.rowspan\n\t\t\t\tif (dir === 'right') nCS = Math.min(sz.colspan + 1, gi.columns.length - cc.column + 1)\n\t\t\t\telse if (dir === 'left') nCS = Math.max(1, sz.colspan - 1)\n\t\t\t\telse if (dir === 'down') nRS = sz.rowspan + 1\n\t\t\t\telse nRS = Math.max(1, sz.rowspan - 1)\n\t\t\t\tif (nCS === sz.colspan && nRS === sz.rowspan) return\n\n\t\t\t\tif (pendingVtnRestore) { clearTimeout(pendingVtnRestore.tid); pendingVtnRestore.item.style.removeProperty('view-transition-name'); pendingVtnRestore = null }\n\t\t\t\tconst handle = dir === 'right' || dir === 'down' ? 'se' : dir === 'left' ? 'w' : 'n'\n\t\t\t\tcore.phase = 'interacting'\n\t\t\t\tcore.interaction = { type: 'resize', mode: 'keyboard', itemId: getItemId(sel), element: sel, columnCount: gi.columns.length }\n\t\t\t\t;(sel.style as any).viewTransitionName = 'resizing'\n\t\t\t\tcore.emit('resize-start', { item: sel, cell: cc, colspan: sz.colspan, rowspan: sz.rowspan, handle })\n\t\t\t\tsel.setAttribute('data-egg-colspan', String(nCS))\n\t\t\t\tsel.setAttribute('data-egg-rowspan', String(nRS))\n\t\t\t\tcore.emit('resize-end', { item: sel, cell: cc, colspan: nCS, rowspan: nRS })\n\t\t\t\tcore.phase = 'selected'; core.interaction = null\n\t\t\t\tconst itemToRestore = sel\n\t\t\t\tconst tid = window.setTimeout(() => { itemToRestore.style.removeProperty('view-transition-name'); if (pendingVtnRestore?.item === itemToRestore) pendingVtnRestore = null }, 250)\n\t\t\t\tpendingVtnRestore = { item: itemToRestore, tid }\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tlet amt = 1\n\t\t\tif (e.ctrlKey || e.metaKey) amt = (dir === 'up' || dir === 'down') ? sz.rowspan : sz.colspan\n\t\t\tconst rawCell = getAdjacentCell(cc, dir, amt)\n\t\t\tconst maxCol = Math.max(1, gi.columns.length - sz.colspan + 1)\n\t\t\tconst maxRow = Math.max(1, gi.rows.length - sz.rowspan + 1)\n\t\t\tconst tc = { column: Math.max(1, Math.min(maxCol, rawCell.column)), row: Math.max(1, Math.min(maxRow, rawCell.row)) }\n\t\t\tif (tc.column === cc.column && tc.row === cc.row) return\n\n\t\t\tconst held = getHeldItem()\n\t\t\tif (held) {\n\t\t\t\tkbTargetCell = tc\n\t\t\t\tcore.emit('drag-move', { item: held, cell: tc, x: 0, y: 0, colspan: sz.colspan, rowspan: sz.rowspan, source: 'keyboard' })\n\t\t\t} else {\n\t\t\t\tcore.emit('drag-start', { item: sel, cell: cc, colspan: sz.colspan, rowspan: sz.rowspan, source: 'keyboard' })\n\t\t\t\tcore.emit('drag-end', { item: sel, cell: tc, colspan: sz.colspan, rowspan: sz.rowspan, source: 'keyboard' })\n\t\t\t}\n\t\t}\n\n\t\tdocument.addEventListener('keydown', onKeyDown)\n\t\tcleanups.push(() => { document.removeEventListener('keydown', onKeyDown); element.removeAttribute('data-egg-keyboard-mode') })\n\t}\n\n\t// ── Algorithm Harness (unified drag + resize) ──────────────────────────────\n\n\tif (options.algorithm !== false) {\n\t\tconst algoType = options.algorithm ?? 'push'\n\t\tconst compact = options.compaction ?? true\n\t\tconst layoutModel = options.responsive?.layoutModel ?? options.layoutModel\n\n\t\tfunction getColumnCount(): number {\n\t\t\tconst s = getComputedStyle(element)\n\t\t\treturn Math.max(1, s.gridTemplateColumns.split(' ').filter(Boolean).length)\n\t\t}\n\n\t\t// Unified interaction state\n\t\tlet ix: {\n\t\t\ttype: 'drag' | 'resize'\n\t\t\titemId: string; element: HTMLElement; source: string\n\t\t\tcolumnCount: number\n\t\t\toriginals: Map<string, ItemRect>\n\t\t\tpendingCell: GridCell | null\n\t\t\tlastResize: { cell: GridCell; colspan: number; rowspan: number } | null\n\t\t\tlayout: ItemRect[] | null\n\t\t\tversion: number\n\t\t} | null = null\n\t\tlet layoutVersion = 0\n\n\t\tfunction calcLayout(items: ItemRect[], movedId: string, cell: GridCell, cols: number, colspan?: number, rowspan?: number): ItemRect[] {\n\t\t\tif (ix?.type === 'resize' && colspan != null && rowspan != null) {\n\t\t\t\tconst updated = items.map(i => i.id === movedId ? { ...i, column: cell.column, row: cell.row, width: colspan, height: rowspan } : i)\n\t\t\t\treturn calculatePushLayout(updated, movedId, cell, compact)\n\t\t\t}\n\t\t\treturn calculatePushLayout(items, movedId, cell, compact)\n\t\t}\n\n\t\tfunction getItemsWithOriginals(excludeId: string | null, originals: Map<string, ItemRect>): ItemRect[] {\n\t\t\treturn readItemsFromDOM(element).map(item => {\n\t\t\t\tconst orig = originals.get(item.id)\n\t\t\t\tif (orig && item.id !== excludeId) return { ...item, column: orig.column, row: orig.row }\n\t\t\t\treturn item\n\t\t\t})\n\t\t}\n\n\t\tfunction getResizeItems(originals: Map<string, ItemRect>, resizedId: string, cell: GridCell, colspan: number, rowspan: number): ItemRect[] {\n\t\t\tconst items: ItemRect[] = []\n\t\t\tfor (const [id, o] of originals) {\n\t\t\t\tif (id === resizedId) items.push({ id, column: cell.column, row: cell.row, width: colspan, height: rowspan })\n\t\t\t\telse items.push({ ...o })\n\t\t\t}\n\t\t\treturn items\n\t\t}\n\n\t\tfunction applyLayout(layout: ItemRect[], excludeId: string | null, useVT: boolean, onApplied?: () => void) {\n\t\t\tconst v = ++layoutVersion\n\t\t\tif (ix) { ix.layout = layout; ix.version = v }\n\n\t\t\tconst doApply = () => {\n\t\t\t\tif (v !== layoutVersion) return\n\t\t\t\tcore.previewCSS = layoutToCSS(layout, { excludeId: excludeId ?? undefined, maxColumns: ix?.columnCount })\n\t\t\t\tcore.commitStyles()\n\t\t\t\tconst els = element.querySelectorAll('[data-egg-item]')\n\t\t\t\tfor (const el of els) {\n\t\t\t\t\tconst e = el as HTMLElement\n\t\t\t\t\tconst id = getItemId(e)\n\t\t\t\t\tif (id !== excludeId && e.style.viewTransitionName !== 'none') {\n\t\t\t\t\t\te.style.gridColumn = ''; e.style.gridRow = ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tonApplied?.()\n\t\t\t}\n\n\t\t\tif (useVT && 'startViewTransition' in document) {\n\t\t\t\tif (ix?.type === 'drag' && ix.element) ix.element.style.viewTransitionName = 'dragging'\n\t\t\t\t;(document as any).startViewTransition(doApply)\n\t\t\t} else doApply()\n\t\t}\n\n\t\tfunction saveAndClear(layout: ItemRect[], cols: number, afterSave?: () => void) {\n\t\t\tif (!layoutModel || !cols) return\n\t\t\tconst positions = new Map<string, { column: number; row: number }>()\n\t\t\tfor (const item of layout) positions.set(item.id, { column: item.column, row: item.row })\n\t\t\tlayoutModel.saveLayout(cols, positions)\n\t\t\tafterSave?.()\n\t\t\tcore.previewCSS = ''\n\t\t\tcore.commitStyles()\n\t\t\tcore.emit('layout-change', { items: layout, columnCount: cols })\n\t\t}\n\n\t\t// Event handlers\n\t\tconst onStart = (e: Event) => {\n\t\t\tconst detail = (e as CustomEvent).detail\n\t\t\tconst isDrag = e.type === 'egg-drag-start'\n\t\t\tconst itemId = getItemId(detail.item)\n\t\t\tconst items = readItemsFromDOM(element)\n\t\t\tconst originals = new Map<string, ItemRect>()\n\t\t\tfor (const i of items) originals.set(i.id, { ...i })\n\n\t\t\tix = {\n\t\t\t\ttype: isDrag ? 'drag' : 'resize', itemId, element: detail.item, source: detail.source,\n\t\t\t\tcolumnCount: getColumnCount(), originals, pendingCell: null, lastResize: null, layout: null, version: 0,\n\t\t\t}\n\n\t\t\t// Clear inline styles so CSS injection takes effect\n\t\t\tconst els = element.querySelectorAll('[data-egg-item]')\n\t\t\tfor (const el of els) {\n\t\t\t\tconst e = el as HTMLElement\n\t\t\t\tif (e !== detail.item) { e.style.gridColumn = ''; e.style.gridRow = '' }\n\t\t\t}\n\t\t\tcore.previewCSS = layoutToCSS(items, { maxColumns: ix.columnCount })\n\t\t\tcore.commitStyles()\n\t\t}\n\n\t\tconst onMove = (e: Event) => {\n\t\t\tif (!ix) return\n\t\t\tconst detail = (e as CustomEvent).detail\n\n\t\t\tif (ix.type === 'drag') {\n\t\t\t\tif (core.cameraScrolling) { ix.pendingCell = detail.cell; return }\n\t\t\t\tix.pendingCell = null\n\t\t\t\tconst items = getItemsWithOriginals(ix.itemId, ix.originals)\n\t\t\t\tconst layout = calcLayout(items, ix.itemId, detail.cell, ix.columnCount)\n\t\t\t\tapplyLayout(layout, ix.itemId, true)\n\t\t\t} else {\n\t\t\t\t// Resize move — deduplicate\n\t\t\t\tconst { cell, colspan, rowspan } = detail\n\t\t\t\tif (ix.lastResize && ix.lastResize.cell.column === cell.column && ix.lastResize.cell.row === cell.row && ix.lastResize.colspan === colspan && ix.lastResize.rowspan === rowspan) return\n\t\t\t\tix.lastResize = { cell: { ...cell }, colspan, rowspan }\n\t\t\t\tconst items = getResizeItems(ix.originals, ix.itemId, cell, colspan, rowspan)\n\t\t\t\tconst layout = calcLayout(items, ix.itemId, cell, ix.columnCount, colspan, rowspan)\n\t\t\t\tapplyLayout(layout, ix.itemId, true)\n\t\t\t}\n\t\t}\n\n\t\tconst onEnd = (e: Event) => {\n\t\t\tif (!ix) return\n\t\t\tconst detail = (e as CustomEvent).detail\n\t\t\tconst savedIx = ix\n\n\t\t\tif (savedIx.element.style.viewTransitionName === 'dragging') savedIx.element.style.viewTransitionName = ''\n\t\t\tconst useVT = savedIx.source !== 'pointer'\n\n\t\t\tlet finalLayout: ItemRect[]\n\t\t\tif (savedIx.type === 'drag') {\n\t\t\t\tconst items = getItemsWithOriginals(savedIx.itemId, savedIx.originals)\n\t\t\t\tfinalLayout = calcLayout(items, savedIx.itemId, detail.cell, savedIx.columnCount)\n\t\t\t} else {\n\t\t\t\tconst items = getResizeItems(savedIx.originals, savedIx.itemId, detail.cell, detail.colspan, detail.rowspan)\n\t\t\t\tfinalLayout = calcLayout(items, savedIx.itemId, detail.cell, savedIx.columnCount, detail.colspan, detail.rowspan)\n\t\t\t}\n\n\t\t\tconst savedCols = savedIx.columnCount\n\t\t\tconst isResize = savedIx.type === 'resize'\n\t\t\tconst savedItemId = savedIx.itemId\n\n\t\t\tapplyLayout(finalLayout, null, useVT, () =>\n\t\t\t\tsaveAndClear(finalLayout, savedCols, isResize ? () => layoutModel?.updateItemSize(savedItemId, { width: detail.colspan, height: detail.rowspan }) : undefined),\n\t\t\t)\n\t\t\tix = null\n\t\t}\n\n\t\tconst onCancel = () => {\n\t\t\tif (!ix) return\n\t\t\tconst restoreLayout = Array.from(ix.originals.values())\n\t\t\tconst restore = () => applyLayout(restoreLayout, null, false)\n\t\t\tif ('startViewTransition' in document) (document as any).startViewTransition(restore)\n\t\t\telse restore()\n\t\t\tix = null\n\t\t}\n\n\t\tconst onCameraSettled = () => {\n\t\t\tif (!ix || ix.type !== 'drag') return\n\t\t\tlet cell = ix.pendingCell\n\t\t\tif (!cell && ix.element) {\n\t\t\t\tconst r = ix.element.getBoundingClientRect()\n\t\t\t\tcell = core.getCellFromPoint(r.left + r.width / 2, r.top + r.height / 2)\n\t\t\t}\n\t\t\tif (!cell) return\n\t\t\tix.pendingCell = null\n\t\t\tconst items = getItemsWithOriginals(ix.itemId, ix.originals)\n\t\t\tconst layout = calcLayout(items, ix.itemId, cell, ix.columnCount)\n\t\t\tapplyLayout(layout, ix.itemId, true)\n\t\t}\n\n\t\tconst events: Record<string, EventListener> = {\n\t\t\t'egg-drag-start': onStart, 'egg-drag-move': onMove, 'egg-drag-end': onEnd, 'egg-drag-cancel': onCancel,\n\t\t\t'egg-resize-start': onStart, 'egg-resize-move': onMove, 'egg-resize-end': onEnd, 'egg-resize-cancel': onCancel,\n\t\t\t'egg-camera-settled': onCameraSettled,\n\t\t}\n\t\tfor (const [name, handler] of Object.entries(events)) element.addEventListener(name, handler)\n\t\tcleanups.push(() => { for (const [name, handler] of Object.entries(events)) element.removeEventListener(name, handler) })\n\t}\n\n\t// ── Camera ─────────────────────────────────────────────────────────────────\n\n\tif (options.camera !== false) {\n\t\tconst camOpts = typeof options.camera === 'object' ? options.camera : {}\n\t\tconst edgeSize = camOpts.edgeSize ?? 60\n\t\tconst scrollSpeed = camOpts.scrollSpeed ?? 15\n\t\tconst settleDelay = camOpts.settleDelay ?? 150\n\n\t\tlet scrollContainer: HTMLElement | Window = window\n\t\tlet p = element.parentElement\n\t\twhile (p) {\n\t\t\tconst s = getComputedStyle(p)\n\t\t\tif (s.overflowY === 'auto' || s.overflowY === 'scroll' || s.overflowX === 'auto' || s.overflowX === 'scroll') { scrollContainer = p; break }\n\t\t\tp = p.parentElement\n\t\t}\n\n\t\tlet isDragging = false, dragSrc: string | null = null\n\t\tlet lastPX = 0, lastPY = 0\n\t\tlet rafId: number | null = null, settleId: ReturnType<typeof setTimeout> | null = null\n\t\tlet wasScrolling = false\n\n\t\tfunction setScrolling(active: boolean) {\n\t\t\tif (active) {\n\t\t\t\tcore.cameraScrolling = true\n\t\t\t\tif (settleId) { clearTimeout(settleId); settleId = null }\n\t\t\t} else {\n\t\t\t\tif (settleId) clearTimeout(settleId)\n\t\t\t\tsettleId = setTimeout(() => {\n\t\t\t\t\tcore.cameraScrolling = false; settleId = null\n\t\t\t\t\telement.dispatchEvent(new CustomEvent('egg-camera-settled', { bubbles: true }))\n\t\t\t\t}, settleDelay)\n\t\t\t}\n\t\t}\n\n\t\tfunction scrollLoop() {\n\t\t\tif (!isDragging) { rafId = null; if (wasScrolling) { setScrolling(false); wasScrolling = false }; return }\n\t\t\tconst vp = scrollContainer === window\n\t\t\t\t? { top: 0, left: 0, width: window.innerWidth, height: window.innerHeight }\n\t\t\t\t: (() => { const r = (scrollContainer as HTMLElement).getBoundingClientRect(); return { top: r.top, left: r.left, width: r.width, height: r.height } })()\n\t\t\tconst rx = lastPX - vp.left, ry = lastPY - vp.top\n\t\t\tlet vx = 0, vy = 0\n\t\t\tif (rx < edgeSize) vx = -scrollSpeed * (1 - rx / edgeSize)\n\t\t\telse if (rx > vp.width - edgeSize) vx = scrollSpeed * (1 - (vp.width - rx) / edgeSize)\n\t\t\tif (ry < edgeSize) vy = -scrollSpeed * (1 - ry / edgeSize)\n\t\t\telse if (ry > vp.height - edgeSize) vy = scrollSpeed * (1 - (vp.height - ry) / edgeSize)\n\n\t\t\tif (vx || vy) {\n\t\t\t\tif (!wasScrolling) setScrolling(true)\n\t\t\t\twasScrolling = true\n\t\t\t\tif (scrollContainer === window) window.scrollBy(vx, vy)\n\t\t\t\telse { (scrollContainer as HTMLElement).scrollLeft += vx; (scrollContainer as HTMLElement).scrollTop += vy }\n\t\t\t} else if (wasScrolling) { setScrolling(false); wasScrolling = false }\n\t\t\trafId = requestAnimationFrame(scrollLoop)\n\t\t}\n\n\t\tconst onCamPtrMove = (e: PointerEvent) => { if (!isDragging) return; lastPX = e.clientX; lastPY = e.clientY; if (rafId === null) rafId = requestAnimationFrame(scrollLoop) }\n\t\tconst stopLoop = () => { if (rafId !== null) { cancelAnimationFrame(rafId); rafId = null }; setScrolling(false) }\n\n\t\tconst camEvents: Record<string, EventListener> = {\n\t\t\t'egg-drag-start': ((e: CustomEvent) => { isDragging = true; dragSrc = e.detail.source; if (dragSrc === 'pointer') window.addEventListener('pointermove', onCamPtrMove) }) as EventListener,\n\t\t\t'egg-drag-move': ((e: CustomEvent) => { if (e.detail.source === 'pointer') { lastPX = e.detail.x; lastPY = e.detail.y } else requestAnimationFrame(() => e.detail.item.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' })) }) as EventListener,\n\t\t\t'egg-drag-end': ((e: CustomEvent) => { const wp = dragSrc === 'pointer'; isDragging = false; dragSrc = null; stopLoop(); if (wp) window.removeEventListener('pointermove', onCamPtrMove); if (!wp) setTimeout(() => requestAnimationFrame(() => e.detail.item.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' })), 100) }) as EventListener,\n\t\t\t'egg-drag-cancel': (() => { const wp = dragSrc === 'pointer'; isDragging = false; dragSrc = null; stopLoop(); if (wp) window.removeEventListener('pointermove', onCamPtrMove) }) as EventListener,\n\t\t\t'egg-select': ((e: CustomEvent) => { if (!isDragging) e.detail.item.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' }) }) as EventListener,\n\t\t}\n\t\tfor (const [name, handler] of Object.entries(camEvents)) element.addEventListener(name, handler)\n\t\tcleanups.push(() => { stopLoop(); for (const [name, handler] of Object.entries(camEvents)) element.removeEventListener(name, handler) })\n\t}\n\n\t// ── Placeholder ────────────────────────────────────────────────────────────\n\n\tif (options.placeholder !== false) {\n\t\tconst phOpts = typeof options.placeholder === 'object' ? options.placeholder : {}\n\t\tconst className = phOpts.className ?? 'egg-placeholder'\n\t\tlet ph: HTMLElement | null = null\n\n\t\tfunction createPH() { if (ph) return; ph = document.createElement('div'); ph.className = className; ph.style.pointerEvents = 'none'; ph.style.viewTransitionName = 'none'; element.appendChild(ph) }\n\t\tfunction updatePH(c: number, r: number, cs: number, rs: number) { if (!ph) return; ph.style.gridColumn = `${c} / span ${cs}`; ph.style.gridRow = `${r} / span ${rs}` }\n\t\tfunction removePH() { if (ph) { ph.remove(); ph = null } }\n\n\t\tconst phEvents: Record<string, EventListener> = {\n\t\t\t'egg-drag-start': ((e: CustomEvent) => { createPH(); updatePH(e.detail.cell.column, e.detail.cell.row, e.detail.colspan, e.detail.rowspan) }) as EventListener,\n\t\t\t'egg-drag-move': ((e: CustomEvent) => { updatePH(e.detail.cell.column, e.detail.cell.row, e.detail.colspan, e.detail.rowspan) }) as EventListener,\n\t\t\t'egg-drop-preview': ((e: CustomEvent) => { updatePH(e.detail.cell.column, e.detail.cell.row, e.detail.colspan, e.detail.rowspan) }) as EventListener,\n\t\t\t'egg-drag-end': (() => removePH()) as EventListener,\n\t\t\t'egg-drag-cancel': (() => removePH()) as EventListener,\n\t\t\t'egg-resize-start': ((e: CustomEvent) => { createPH(); updatePH(e.detail.cell.column, e.detail.cell.row, e.detail.colspan, e.detail.rowspan) }) as EventListener,\n\t\t\t'egg-resize-move': ((e: CustomEvent) => { updatePH(e.detail.cell.column, e.detail.cell.row, e.detail.colspan, e.detail.rowspan) }) as EventListener,\n\t\t\t'egg-resize-end': (() => removePH()) as EventListener,\n\t\t\t'egg-resize-cancel': (() => removePH()) as EventListener,\n\t\t}\n\t\tfor (const [name, handler] of Object.entries(phEvents)) element.addEventListener(name, handler)\n\t\tdocument.addEventListener('pointerup', () => requestAnimationFrame(() => { if (ph && !document.querySelector('[data-egg-dragging]') && !document.querySelector('[data-egg-resizing]')) removePH() }))\n\t\tcleanups.push(() => { removePH(); for (const [name, handler] of Object.entries(phEvents)) element.removeEventListener(name, handler) })\n\t}\n\n\t// ── Accessibility ──────────────────────────────────────────────────────────\n\n\tif (options.accessibility !== false) {\n\t\tconst live = document.createElement('div')\n\t\tlive.setAttribute('aria-live', 'assertive'); live.setAttribute('aria-atomic', 'true')\n\t\tObject.assign(live.style, { position: 'absolute', width: '1px', height: '1px', padding: '0', margin: '-1px', overflow: 'hidden', clip: 'rect(0,0,0,0)', whiteSpace: 'nowrap', border: '0' })\n\t\telement.appendChild(live)\n\t\tlet lastA11yCell: GridCell | null = null, lastA11ySize: { colspan: number; rowspan: number } | null = null\n\n\t\tfunction announce(msg: string) { live.textContent = ''; requestAnimationFrame(() => { live.textContent = msg }) }\n\t\tfunction label(item: HTMLElement) { return item.getAttribute('data-egg-label') || item.getAttribute('aria-label') || item.id || 'Item' }\n\t\tfunction pos(cell: GridCell) { return `row ${cell.row}, column ${cell.column}` }\n\t\tfunction tpl(item: HTMLElement, event: string, vars: Record<string, string>, fallback: string): string {\n\t\t\tconst t = item.getAttribute(`data-egg-announce-${event}`) || element.getAttribute(`data-egg-announce-${event}`)\n\t\t\treturn t ? t.replace(/\\{(\\w+)\\}/g, (_, k) => vars[k] ?? '') : fallback\n\t\t}\n\n\t\tconst a11yEvents: Record<string, EventListener> = {\n\t\t\t'egg-drag-start': ((e: CustomEvent) => { lastA11yCell = e.detail.cell; const l = label(e.detail.item), p = pos(e.detail.cell); announce(tpl(e.detail.item, 'grab', { label: l, row: String(e.detail.cell.row), column: String(e.detail.cell.column) }, `${l} grabbed. Position ${p}. Use arrow keys to move, Enter to drop, Escape to cancel.`)) }) as EventListener,\n\t\t\t'egg-drag-move': ((e: CustomEvent) => { const c = e.detail.cell; if (lastA11yCell && c.row === lastA11yCell.row && c.column === lastA11yCell.column) return; lastA11yCell = c; announce(tpl(e.detail.item, 'move', { label: label(e.detail.item), row: String(c.row), column: String(c.column) }, `Moved to ${pos(c)}.`)) }) as EventListener,\n\t\t\t'egg-drag-end': ((e: CustomEvent) => { lastA11yCell = null; const l = label(e.detail.item), p = pos(e.detail.cell); announce(tpl(e.detail.item, 'drop', { label: l, row: String(e.detail.cell.row), column: String(e.detail.cell.column) }, `${l} dropped at ${p}.`)) }) as EventListener,\n\t\t\t'egg-drag-cancel': ((e: CustomEvent) => { lastA11yCell = null; announce(tpl(e.detail.item, 'cancel', { label: label(e.detail.item) }, `${label(e.detail.item)} drag cancelled.`)) }) as EventListener,\n\t\t\t'egg-resize-start': ((e: CustomEvent) => { lastA11ySize = { colspan: e.detail.colspan, rowspan: e.detail.rowspan }; const sz = `${e.detail.colspan} columns by ${e.detail.rowspan} rows`; announce(tpl(e.detail.item, 'resize-start', { label: label(e.detail.item), colspan: String(e.detail.colspan), rowspan: String(e.detail.rowspan) }, `${label(e.detail.item)} resize started. Size ${sz}.`)) }) as EventListener,\n\t\t\t'egg-resize-move': ((e: CustomEvent) => { if (lastA11ySize && e.detail.colspan === lastA11ySize.colspan && e.detail.rowspan === lastA11ySize.rowspan) return; lastA11ySize = { colspan: e.detail.colspan, rowspan: e.detail.rowspan }; announce(tpl(e.detail.item, 'resize-move', { label: label(e.detail.item), colspan: String(e.detail.colspan), rowspan: String(e.detail.rowspan) }, `Resized to ${e.detail.colspan} columns by ${e.detail.rowspan} rows.`)) }) as EventListener,\n\t\t\t'egg-resize-end': ((e: CustomEvent) => { lastA11ySize = null; const sz = `${e.detail.colspan} columns by ${e.detail.rowspan} rows`; announce(tpl(e.detail.item, 'resize-end', { label: label(e.detail.item), colspan: String(e.detail.colspan), rowspan: String(e.detail.rowspan), row: String(e.detail.cell.row), column: String(e.detail.cell.column) }, `${label(e.detail.item)} resized to ${sz} at ${pos(e.detail.cell)}.`)) }) as EventListener,\n\t\t\t'egg-resize-cancel': ((e: CustomEvent) => { lastA11ySize = null; announce(tpl(e.detail.item, 'resize-cancel', { label: label(e.detail.item) }, `${label(e.detail.item)} resize cancelled.`)) }) as EventListener,\n\t\t}\n\t\tfor (const [name, handler] of Object.entries(a11yEvents)) element.addEventListener(name, handler)\n\t\tcleanups.push(() => { live.remove(); for (const [name, handler] of Object.entries(a11yEvents)) element.removeEventListener(name, handler) })\n\t}\n\n\t// ── Responsive ─────────────────────────────────────────────────────────────\n\n\tif (options.responsive) {\n\t\tconst { layoutModel } = options.responsive\n\t\tlet cellSize = options.responsive.cellSize\n\t\tlet gap = options.responsive.gap\n\n\t\tfunction inferMetrics() {\n\t\t\tif (cellSize !== undefined && gap !== undefined) return\n\t\t\tconst s = getComputedStyle(element)\n\t\t\tif (gap === undefined) gap = parseFloat(s.columnGap) || parseFloat(s.gap) || 16\n\t\t\tif (cellSize === undefined) { const ar = parseFloat(s.gridAutoRows); cellSize = ar > 0 ? ar : parseFloat(s.gridTemplateColumns.split(' ')[0] ?? '184') || 184 }\n\t\t}\n\n\t\tfunction injectCSS() {\n\t\t\tinferMetrics()\n\t\t\tconst gridSelector = element.id ? `#${element.id}` : element.className ? `.${element.className.split(' ')[0]}` : '.grid'\n\t\t\tcore.baseCSS = layoutModel.generateAllBreakpointCSS({ cellSize: cellSize!, gap: gap!, gridSelector })\n\t\t\tcore.commitStyles()\n\t\t}\n\n\t\tif (!core.baseCSS.trim()) injectCSS()\n\t\tconst unsub = layoutModel.subscribe(() => injectCSS())\n\n\t\tlet lastColCount = layoutModel.currentColumnCount\n\t\tconst ro = new ResizeObserver(() => {\n\t\t\tconst s = getComputedStyle(element)\n\t\t\tconst newCount = Math.max(1, s.gridTemplateColumns.split(' ').filter(Boolean).length)\n\t\t\tif (newCount !== lastColCount) {\n\t\t\t\tconst prev = lastColCount; lastColCount = newCount\n\t\t\t\tlayoutModel.setCurrentColumnCount(newCount)\n\t\t\t\telement.dispatchEvent(new CustomEvent('egg-column-count-change', { bubbles: true, detail: { previousCount: prev, currentCount: newCount } }))\n\t\t\t}\n\t\t})\n\t\tro.observe(element)\n\t\tcleanups.push(() => { ro.disconnect(); unsub() })\n\t}\n\n\t// Snapshot initial layout from inline styles → CSS, then clear inline styles\n\t// so CSS injection controls layout from here on. Skip if responsive plugin\n\t// already injected CSS (it writes to baseCSS).\n\tif (!options.responsive && !core.baseCSS) {\n\t\tconst items = readItemsFromDOM(element)\n\t\tcore.baseCSS = layoutToCSS(items)\n\t\tcore.commitStyles()\n\t\telement.querySelectorAll('[data-egg-item]').forEach(el => {\n\t\t\t(el as HTMLElement).style.removeProperty('grid-column');\n\t\t\t(el as HTMLElement).style.removeProperty('grid-row')\n\t\t})\n\t}\n\n\treturn core\n}\n\n// ── Exports ────────────────────────────────────────────────────────────────────\n\nexport { getItemCell, getItemSize, getItemId, layoutToCSS, readItemsFromDOM }\nexport { calculatePushLayout, itemsOverlap, pushDown, compactUp }\nexport type { GridCell, ItemRect, ResizeHandle, EggCore, InitOptions, ResponsiveLayoutModel }\n","/**\n * Responsive Layout Model\n *\n * Manages layouts across different column counts with a three-tier system:\n * 1. Canonical layout - source of truth at maxColumns\n * 2. Per-column-count overrides - user customizations at specific breakpoints\n * 3. Auto-derived layouts - calculated via compaction for other column counts\n *\n * This module is pure data/logic with no DOM dependencies, making it suitable\n * for use with backend-driven state (e.g., Datastar integration).\n */\n\n// ── Types (self-contained) ───────────────────────────────────────────────────\n\nexport interface ItemDefinition {\n\tid: string\n\twidth: number\n\theight: number\n}\n\nexport interface ItemPosition {\n\tcolumn: number\n\trow: number\n}\n\nexport interface BreakpointCSSOptions {\n\tselectorPrefix?: string\n\tselectorSuffix?: string\n\tcellSize: number\n\tgap: number\n\tgridSelector?: string\n}\n\nexport interface CreateLayoutModelOptions {\n\tmaxColumns: number\n\tminColumns?: number\n\titems: ItemDefinition[]\n\tcanonicalPositions: Map<string, ItemPosition>\n\toverrides?: Map<number, Map<string, ItemPosition>>\n}\n\nexport interface ResponsiveLayoutModel {\n\treadonly maxColumns: number\n\treadonly minColumns: number\n\treadonly items: ReadonlyMap<string, ItemDefinition>\n\treadonly currentColumnCount: number\n\tgetLayoutForColumns(columnCount: number): Map<string, ItemPosition>\n\tgetCurrentLayout(): Map<string, ItemPosition>\n\thasOverride(columnCount: number): boolean\n\tgetOverrideColumnCounts(): number[]\n\tsaveLayout(columnCount: number, positions: Map<string, ItemPosition>): void\n\tclearOverride(columnCount: number): void\n\tupdateItemSize(itemId: string, size: { width: number; height: number }): void\n\tsetCurrentColumnCount(columnCount: number): void\n\tgenerateAllBreakpointCSS(options?: BreakpointCSSOptions): string\n\tsubscribe(callback: () => void): () => void\n}\n\nconst MAX_ROWS = 100; // Safety limit for layout derivation\n\n/**\n * Create a responsive layout model\n */\nexport function createLayoutModel(\n\toptions: CreateLayoutModelOptions,\n): ResponsiveLayoutModel {\n\tconst { maxColumns, minColumns = 1, items: itemDefs } = options;\n\n\t// Store item definitions\n\tconst items = new Map<string, ItemDefinition>();\n\tfor (const item of itemDefs) {\n\t\titems.set(item.id, { id: item.id, width: item.width, height: item.height });\n\t}\n\n\t// Store canonical positions (at maxColumns)\n\tlet canonicalPositions = new Map<string, ItemPosition>(\n\t\toptions.canonicalPositions,\n\t);\n\n\t// Store per-column-count overrides\n\tconst overrides = new Map<number, Map<string, ItemPosition>>(\n\t\toptions.overrides,\n\t);\n\n\t// Current column count (updated by responsive plugin)\n\tlet currentColumnCount = maxColumns;\n\n\t// Subscribers for layout changes\n\tconst subscribers = new Set<() => void>();\n\n\tfunction notifySubscribers(): void {\n\t\tfor (const callback of Array.from(subscribers)) {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\t/**\n\t * Get items sorted by position (top-to-bottom, left-to-right)\n\t * Used for consistent ordering in layout derivation\n\t */\n\tfunction getItemsInPositionOrder(\n\t\tpositions: Map<string, ItemPosition>,\n\t): ItemDefinition[] {\n\t\treturn Array.from(items.values()).sort((a, b) => {\n\t\t\tconst posA = positions.get(a.id) ?? { column: 0, row: 0 };\n\t\t\tconst posB = positions.get(b.id) ?? { column: 0, row: 0 };\n\t\t\t// Sort by row first, then column\n\t\t\treturn posA.row - posB.row || posA.column - posB.column;\n\t\t});\n\t}\n\n\t/**\n\t * Derive layout for a given column count using first-fit compaction.\n\t * Items are placed in position order (top-to-bottom, left-to-right)\n\t * into the first available space that fits.\n\t */\n\tfunction deriveLayoutForColumns(\n\t\tcols: number,\n\t\tsourcePositions: Map<string, ItemPosition>,\n\t): Map<string, ItemPosition> {\n\t\tconst sorted = getItemsInPositionOrder(sourcePositions);\n\t\tconst result = new Map<string, ItemPosition>();\n\n\t\t// 2D occupancy grid: occupied[row][col] = itemId or null\n\t\tconst occupied: (string | null)[][] = [];\n\t\tfor (let r = 0; r < MAX_ROWS; r++) {\n\t\t\toccupied.push(new Array(cols).fill(null));\n\t\t}\n\n\t\tfor (const itemDef of sorted) {\n\t\t\t// Clamp width to available columns\n\t\t\tconst w = Math.min(itemDef.width, cols);\n\t\t\tconst h = itemDef.height;\n\n\t\t\t// Find first available position (first-fit)\n\t\t\tlet placed = false;\n\t\t\tfor (let row = 0; row < MAX_ROWS && !placed; row++) {\n\t\t\t\tfor (let col = 0; col <= cols - w && !placed; col++) {\n\t\t\t\t\t// Check if space is available\n\t\t\t\t\tlet canFit = true;\n\t\t\t\t\tfor (let dy = 0; dy < h && canFit; dy++) {\n\t\t\t\t\t\tfor (let dx = 0; dx < w && canFit; dx++) {\n\t\t\t\t\t\t\tif (occupied[row + dy]?.[col + dx] !== null) {\n\t\t\t\t\t\t\t\tcanFit = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (canFit) {\n\t\t\t\t\t\tresult.set(itemDef.id, { column: col + 1, row: row + 1 }); // 1-indexed for CSS Grid\n\t\t\t\t\t\t// Mark cells as occupied\n\t\t\t\t\t\tfor (let dy = 0; dy < h; dy++) {\n\t\t\t\t\t\t\tfor (let dx = 0; dx < w; dx++) {\n\t\t\t\t\t\t\t\tif (occupied[row + dy]) {\n\t\t\t\t\t\t\t\t\toccupied[row + dy]![col + dx] = itemDef.id;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tplaced = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!placed) {\n\t\t\t\t// Fallback: place at bottom (shouldn't happen with reasonable MAX_ROWS)\n\t\t\t\tresult.set(itemDef.id, { column: 1, row: MAX_ROWS });\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Calculate breakpoint width for a given column count.\n\t * n columns needs: n * cellSize + (n - 1) * gap pixels\n\t */\n\tfunction getBreakpointWidth(cols: number, cellSize: number, gap: number): number {\n\t\treturn cols * cellSize + (cols - 1) * gap;\n\t}\n\n\tconst model: ResponsiveLayoutModel = {\n\t\tget maxColumns() {\n\t\t\treturn maxColumns;\n\t\t},\n\t\tget minColumns() {\n\t\t\treturn minColumns;\n\t\t},\n\t\tget items() {\n\t\t\treturn items;\n\t\t},\n\t\tget currentColumnCount() {\n\t\t\treturn currentColumnCount;\n\t\t},\n\n\t\tgetLayoutForColumns(columnCount: number): Map<string, ItemPosition> {\n\t\t\t// Clamp to valid range\n\t\t\tconst cols = Math.max(minColumns, Math.min(maxColumns, columnCount));\n\n\t\t\tif (cols === maxColumns) {\n\t\t\t\treturn new Map(canonicalPositions);\n\t\t\t}\n\n\t\t\t// Check for explicit override\n\t\t\tconst override = overrides.get(cols);\n\t\t\tif (override) {\n\t\t\t\treturn new Map(override);\n\t\t\t}\n\n\t\t\t// Auto-derive from canonical\n\t\t\treturn deriveLayoutForColumns(cols, canonicalPositions);\n\t\t},\n\n\t\tgetCurrentLayout(): Map<string, ItemPosition> {\n\t\t\treturn this.getLayoutForColumns(currentColumnCount);\n\t\t},\n\n\t\thasOverride(columnCount: number): boolean {\n\t\t\treturn overrides.has(columnCount);\n\t\t},\n\n\t\tgetOverrideColumnCounts(): number[] {\n\t\t\treturn Array.from(overrides.keys()).sort((a, b) => b - a);\n\t\t},\n\n\t\tsaveLayout(columnCount: number, positions: Map<string, ItemPosition>): void {\n\t\t\tconst cols = Math.max(minColumns, Math.min(maxColumns, columnCount));\n\n\t\t\tif (cols === maxColumns) {\n\t\t\t\t// Update canonical layout\n\t\t\t\tcanonicalPositions = new Map(positions);\n\t\t\t} else {\n\t\t\t\t// Create/update override\n\t\t\t\toverrides.set(cols, new Map(positions));\n\t\t\t}\n\n\t\t\tnotifySubscribers();\n\t\t},\n\n\t\tclearOverride(columnCount: number): void {\n\t\t\tif (columnCount === maxColumns) {\n\t\t\t\t// Can't clear canonical layout\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (overrides.delete(columnCount)) {\n\t\t\t\tnotifySubscribers();\n\t\t\t}\n\t\t},\n\n\t\tupdateItemSize(itemId: string, size: { width: number; height: number }): void {\n\t\t\tconst existing = items.get(itemId);\n\t\t\tif (!existing) {\n\t\t\t\tconsole.warn(`[layout-model] updateItemSize: item \"${itemId}\" not found in items Map. Available IDs:`, Array.from(items.keys()));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update the item definition\n\t\t\titems.set(itemId, {\n\t\t\t\tid: itemId,\n\t\t\t\twidth: size.width,\n\t\t\t\theight: size.height,\n\t\t\t});\n\n\t\t\tnotifySubscribers();\n\t\t},\n\n\t\tsetCurrentColumnCount(columnCount: number): void {\n\t\t\tconst newCount = Math.max(minColumns, Math.min(maxColumns, columnCount));\n\t\t\tif (newCount !== currentColumnCount) {\n\t\t\t\tcurrentColumnCount = newCount;\n\t\t\t\t// Note: We don't notify here because this is just tracking state.\n\t\t\t\t// The responsive plugin will emit an event for UI updates.\n\t\t\t}\n\t\t},\n\n\t\tgenerateAllBreakpointCSS(options?: BreakpointCSSOptions): string {\n\t\t\tconst {\n\t\t\t\tselectorPrefix = '[data-egg-item=\"',\n\t\t\t\tselectorSuffix = '\"]',\n\t\t\t\tcellSize,\n\t\t\t\tgap,\n\t\t\t\tgridSelector = '.grid-container',\n\t\t\t} = options ?? { cellSize: 184, gap: 16 };\n\n\t\t\tconst cssRules: string[] = [];\n\n\t\t\t// Generate fallback rules (canonical layout, no container query)\n\t\t\t// These apply immediately before container queries are evaluated\n\t\t\tcssRules.push('/* Fallback: canonical layout (before container queries evaluate) */');\n\t\t\tfor (const [id, pos] of Array.from(canonicalPositions)) {\n\t\t\t\tconst itemDef = items.get(id);\n\t\t\t\tif (!itemDef) continue;\n\t\t\t\tcssRules.push(\n\t\t\t\t\t`${selectorPrefix}${id}${selectorSuffix} { grid-column: ${pos.column} / span ${itemDef.width}; grid-row: ${pos.row} / span ${itemDef.height}; }`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tcssRules.push('');\n\n\t\t\t// Generate rules for each column count (maxColumns down to minColumns)\n\t\t\tfor (let cols = maxColumns; cols >= minColumns; cols--) {\n\t\t\t\tconst positions = this.getLayoutForColumns(cols);\n\t\t\t\tconst minWidth = getBreakpointWidth(cols, cellSize, gap);\n\t\t\t\tconst hasOverride = overrides.has(cols);\n\n\t\t\t\t// Build container query\n\t\t\t\tlet containerQuery: string;\n\t\t\t\tif (cols === maxColumns) {\n\t\t\t\t\tcontainerQuery = `@container (min-width: ${minWidth}px)`;\n\t\t\t\t} else if (cols === minColumns) {\n\t\t\t\t\t// Smallest size is the default/fallback\n\t\t\t\t\tconst maxWidth = getBreakpointWidth(cols + 1, cellSize, gap) - 1;\n\t\t\t\t\tcontainerQuery = `@container (max-width: ${maxWidth}px)`;\n\t\t\t\t} else {\n\t\t\t\t\tconst maxWidth = getBreakpointWidth(cols + 1, cellSize, gap) - 1;\n\t\t\t\t\tcontainerQuery = `@container (min-width: ${minWidth}px) and (max-width: ${maxWidth}px)`;\n\t\t\t\t}\n\n\t\t\t\t// Build rules for this column count\n\t\t\t\tconst itemRules: string[] = [];\n\n\t\t\t\t// Grid template\n\t\t\t\titemRules.push(\n\t\t\t\t\t`${gridSelector} { grid-template-columns: repeat(${cols}, 1fr); }`,\n\t\t\t\t);\n\n\t\t\t\t// Item positions\n\t\t\t\tfor (const [id, pos] of positions) {\n\t\t\t\t\tconst itemDef = items.get(id);\n\t\t\t\t\tif (!itemDef) continue;\n\n\t\t\t\t\t// Clamp width to current column count\n\t\t\t\t\tconst w = Math.min(itemDef.width, cols);\n\t\t\t\t\titemRules.push(\n\t\t\t\t\t\t`${selectorPrefix}${id}${selectorSuffix} { grid-column: ${pos.column} / span ${w}; grid-row: ${pos.row} / span ${itemDef.height}; }`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Add comment and rules\n\t\t\t\tconst layoutType =\n\t\t\t\t\tcols === maxColumns\n\t\t\t\t\t\t? '(canonical)'\n\t\t\t\t\t\t: hasOverride\n\t\t\t\t\t\t\t? '(override)'\n\t\t\t\t\t\t\t: '(derived)';\n\t\t\t\tcssRules.push(`/* ${cols} columns ${layoutType} */`);\n\t\t\t\tcssRules.push(`${containerQuery} {`);\n\t\t\t\tcssRules.push(itemRules.map((r) => '  ' + r).join('\\n'));\n\t\t\t\tcssRules.push('}');\n\t\t\t\tcssRules.push('');\n\t\t\t}\n\n\t\t\treturn cssRules.join('\\n');\n\t\t},\n\n\t\tsubscribe(callback: () => void): () => void {\n\t\t\tsubscribers.add(callback);\n\t\t\treturn () => subscribers.delete(callback);\n\t\t},\n\t};\n\n\treturn model;\n}\n\n","/**\n * <eg-grid> Web Component\n *\n * Progressive enhancement wrapper for EG Grid. The element IS the grid\n * container — no Shadow DOM (items need parent CSS, View Transitions are\n * document-scoped).\n *\n * Usage (zero JS required):\n *\n *   <style>\n *     [data-egg-item=\"item-a\"] { grid-column: 1 / span 2; grid-row: 1; }\n *     [data-egg-item=\"item-b\"] { grid-column: 3; grid-row: 1; }\n *   </style>\n *   <eg-grid columns=\"4\" cell-size=\"120\" gap=\"8\" algorithm=\"push\" resize-handles=\"all\">\n *     <div data-egg-item=\"item-a\">A</div>\n *     <div data-egg-item=\"item-b\">B</div>\n *   </eg-grid>\n */\n\nimport type { EggCore, InitOptions, ResponsiveLayoutModel } from './eg-grid';\nimport { init } from './eg-grid';\nimport type { ItemDefinition, ItemPosition } from './layout-model';\nimport { createLayoutModel } from './layout-model';\n\nlet nextId = 0;\n\n/**\n * Parse the span (width or height in cells) from grid-column/row start+end.\n * getComputedStyle returns: \"auto\", \"3\" (line number), or \"span 2\".\n */\nfunction parseGridSpan(startStr: string, endStr: string): number {\n\t// \"span 2\" → 2\n\tconst spanMatch = endStr.match(/span\\s+(\\d+)/);\n\tif (spanMatch) return parseInt(spanMatch[1]!, 10) || 1;\n\t// \"3\" with start \"1\" → 3 - 1 = 2\n\tconst endNum = parseInt(endStr, 10);\n\tconst startNum = parseInt(startStr, 10) || 1;\n\tif (!isNaN(endNum) && endNum > startNum) return endNum - startNum;\n\t// \"auto\" or anything else → 1\n\treturn 1;\n}\n\n/**\n * Resolve an item element's ID for the layout model.\n *\n * Priority: data-egg-item > data-id > id\n * (data-egg-item=\"\" means \"is an item but no explicit ID\", so skip empty strings)\n */\nfunction resolveItemId(el: HTMLElement): string {\n\treturn el.dataset.eggItem || el.dataset.id || el.id || '';\n}\n\nexport class EgGridElement extends HTMLElement {\n\tstatic observedAttributes = [\n\t\t'columns',\n\t\t'cell-size',\n\t\t'gap',\n\t\t'algorithm',\n\t\t'resize-handles',\n\t\t'no-camera',\n\t\t'no-placeholder',\n\t\t'no-keyboard',\n\t\t'no-accessibility',\n\t\t'placeholder-class',\n\t];\n\n\t/** The EggCore instance. Available after connectedCallback. */\n\tcore: EggCore | null = null;\n\n\t/** The responsive layout model (if columns + cell-size are set). */\n\tlayoutModel: ResponsiveLayoutModel | null = null;\n\n\tprivate _styleEl: HTMLStyleElement | null = null;\n\tprivate _initialized = false;\n\tprivate _rafId = 0;\n\tprivate _observer: MutationObserver | null = null;\n\n\tconnectedCallback(): void {\n\t\tif (this._initialized) return;\n\t\tthis._init();\n\t}\n\n\tdisconnectedCallback(): void {\n\t\tthis._teardown();\n\t}\n\n\tattributeChangedCallback(): void {\n\t\tif (!this._initialized) return;\n\t\tthis._teardown();\n\t\tthis._init();\n\t}\n\n\tprivate _init(): void {\n\t\tthis._initialized = true;\n\n\t\t// Ensure this element has an id (needed for CSS selectors like #my-grid)\n\t\tif (!this.id) {\n\t\t\tthis.id = `egg-${++nextId}`;\n\t\t}\n\n\t\t// 1. Ensure this element is a grid container\n\t\tconst computed = getComputedStyle(this);\n\t\tif (computed.display !== 'grid' && computed.display !== 'inline-grid') {\n\t\t\tthis.style.display = 'grid';\n\t\t}\n\n\t\t// 2. Read attribute values\n\t\tconst columnsAttr = this.getAttribute('columns');\n\t\tconst gapAttr = this.getAttribute('gap');\n\t\tconst cellSizeAttr = this.getAttribute('cell-size');\n\t\tconst algorithmAttr = this.getAttribute('algorithm');\n\t\tconst resizeHandlesAttr = this.getAttribute('resize-handles');\n\n\t\tconst maxColumns = columnsAttr ? parseInt(columnsAttr, 10) || 4 : this._detectColumnCount();\n\t\tconst cellSize = cellSizeAttr ? parseInt(cellSizeAttr, 10) || 120 : 0;\n\t\tconst gap = gapAttr ? parseInt(gapAttr, 10) || 0 : parseFloat(computed.columnGap) || parseFloat(computed.gap) || 0;\n\t\tconst responsive = cellSize > 0 && !!columnsAttr;\n\n\t\t// 3. Apply CSS shortcut attributes via inline styles.\n\t\t//    For responsive mode, grid-template-columns is set via container query CSS,\n\t\t//    not inline styles (inline styles can't be overridden by @container rules).\n\t\t//    For non-responsive, inline styles are fine.\n\t\tif (columnsAttr && !responsive) {\n\t\t\tconst cols = parseInt(columnsAttr, 10);\n\t\t\tif (cols > 0) {\n\t\t\t\tthis.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;\n\t\t\t}\n\t\t}\n\n\t\tif (gapAttr) {\n\t\t\tthis.style.gap = /^\\d+$/.test(gapAttr) ? `${gapAttr}px` : gapAttr;\n\t\t}\n\n\t\t// 4. Container query context for responsive mode.\n\t\t//    @container queries match the nearest ancestor with containment, so the\n\t\t//    parent of <eg-grid> needs container-type, not <eg-grid> itself.\n\t\tif (responsive && this.parentElement) {\n\t\t\tthis.parentElement.style.containerType = 'inline-size';\n\t\t}\n\n\t\t// 5. Create <style> element for CSS injection\n\t\tthis._styleEl = document.createElement('style');\n\t\tthis.prepend(this._styleEl);\n\n\t\t// 6. Auto-setup items — set tabindex, --item-id, derive span from CSS\n\t\tconst items = this.querySelectorAll<HTMLElement>('[data-egg-item]');\n\t\tconst itemDefs: ItemDefinition[] = [];\n\t\tconst canonicalPositions = new Map<string, ItemPosition>();\n\n\t\tfor (const item of items) {\n\t\t\tif (!item.hasAttribute('tabindex')) {\n\t\t\t\titem.setAttribute('tabindex', '0');\n\t\t\t}\n\n\t\t\tconst id = resolveItemId(item);\n\t\t\tif (!id) continue;\n\n\t\t\t// Set --item-id for View Transitions\n\t\t\titem.style.setProperty('--item-id', id);\n\n\t\t\t// Read position and span from computed styles.\n\t\t\t// gridColumnEnd can be \"auto\", \"3\" (line number), or \"span 2\".\n\t\t\t// parseInt(\"span 2\") → NaN, so we must parse span notation explicitly.\n\t\t\tconst itemStyle = getComputedStyle(item);\n\t\t\tconst colStart = parseInt(itemStyle.gridColumnStart, 10) || 1;\n\t\t\tconst rowStart = parseInt(itemStyle.gridRowStart, 10) || 1;\n\n\t\t\tconst cssWidth = parseGridSpan(itemStyle.gridColumnStart, itemStyle.gridColumnEnd);\n\t\t\tconst cssHeight = parseGridSpan(itemStyle.gridRowStart, itemStyle.gridRowEnd);\n\n\t\t\t// Derive span: prefer data attribute, fall back to CSS\n\t\t\tconst width = parseInt(item.getAttribute('data-egg-colspan') || '0', 10) || cssWidth;\n\t\t\tconst height = parseInt(item.getAttribute('data-egg-rowspan') || '0', 10) || cssHeight;\n\n\t\t\t// Ensure data-egg-colspan/rowspan are set for algorithm's readItemsFromDOM\n\t\t\t// (during drag, item is position:fixed so CSS grid values aren't reliable)\n\t\t\tif (!item.hasAttribute('data-egg-colspan') && width > 1) {\n\t\t\t\titem.setAttribute('data-egg-colspan', String(width));\n\t\t\t}\n\t\t\tif (!item.hasAttribute('data-egg-rowspan') && height > 1) {\n\t\t\t\titem.setAttribute('data-egg-rowspan', String(height));\n\t\t\t}\n\n\t\t\titemDefs.push({ id, width, height });\n\t\t\tcanonicalPositions.set(id, { column: colStart, row: rowStart });\n\t\t}\n\n\t\t// 7. Pack items if no explicit CSS positions were set.\n\t\t//    When items lack grid-column/grid-row CSS, getComputedStyle returns \"auto\"\n\t\t//    which resolves to (1,1) for every item. Detect this overlap and run\n\t\t//    first-fit compaction so items don't stack on top of each other.\n\t\tif (canonicalPositions.size > 1) {\n\t\t\tconst allOverlap = Array.from(canonicalPositions.values())\n\t\t\t\t.every(p => p.column === 1 && p.row === 1);\n\t\t\tif (allOverlap) {\n\t\t\t\tconst occupied: (string | null)[][] = [];\n\t\t\t\tfor (let r = 0; r < 100; r++) occupied.push(new Array(maxColumns).fill(null));\n\t\t\t\tfor (const def of itemDefs) {\n\t\t\t\t\tconst w = Math.min(def.width, maxColumns);\n\t\t\t\t\tconst h = def.height;\n\t\t\t\t\tlet placed = false;\n\t\t\t\t\tfor (let row = 0; row < 100 && !placed; row++) {\n\t\t\t\t\t\tfor (let col = 0; col <= maxColumns - w && !placed; col++) {\n\t\t\t\t\t\t\tlet fits = true;\n\t\t\t\t\t\t\tfor (let dy = 0; dy < h && fits; dy++)\n\t\t\t\t\t\t\t\tfor (let dx = 0; dx < w && fits; dx++)\n\t\t\t\t\t\t\t\t\tif (occupied[row + dy]?.[col + dx] !== null) fits = false;\n\t\t\t\t\t\t\tif (fits) {\n\t\t\t\t\t\t\t\tcanonicalPositions.set(def.id, { column: col + 1, row: row + 1 });\n\t\t\t\t\t\t\t\tfor (let dy = 0; dy < h; dy++)\n\t\t\t\t\t\t\t\t\tfor (let dx = 0; dx < w; dx++)\n\t\t\t\t\t\t\t\t\t\tif (occupied[row + dy]) occupied[row + dy]![col + dx] = def.id;\n\t\t\t\t\t\t\t\tplaced = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 8. Build layout model\n\t\tif (itemDefs.length > 0) {\n\t\t\tthis.layoutModel = createLayoutModel({\n\t\t\t\tmaxColumns,\n\t\t\t\tminColumns: 1,\n\t\t\t\titems: itemDefs,\n\t\t\t\tcanonicalPositions,\n\t\t\t});\n\t\t}\n\n\t\t// 9. Build InitOptions from attributes\n\t\tconst options: InitOptions = {\n\t\t\tstyleElement: this._styleEl,\n\t\t\tlayoutModel: this.layoutModel ?? undefined,\n\t\t\talgorithm: algorithmAttr === 'none' ? false : 'push',\n\t\t\tkeyboard: this.hasAttribute('no-keyboard') ? false : undefined,\n\t\t\taccessibility: this.hasAttribute('no-accessibility') ? false : undefined,\n\t\t\tcamera: this.hasAttribute('no-camera') ? false : undefined,\n\t\t\tplaceholder: this.hasAttribute('no-placeholder')\n\t\t\t\t? false\n\t\t\t\t: this.getAttribute('placeholder-class')\n\t\t\t\t\t? { className: this.getAttribute('placeholder-class')! }\n\t\t\t\t\t: undefined,\n\t\t\tresize: resizeHandlesAttr\n\t\t\t\t? { handles: resizeHandlesAttr as 'corners' | 'edges' | 'all' }\n\t\t\t\t: false,\n\t\t};\n\n\t\tif (responsive && this.layoutModel) {\n\t\t\toptions.responsive = {\n\t\t\t\tlayoutModel: this.layoutModel,\n\t\t\t\tcellSize,\n\t\t\t\tgap,\n\t\t\t};\n\t\t}\n\n\t\t// 10. Initialize\n\t\tthis.core = init(this, options);\n\n\t\t// 11. Set data-pointer-active (pointer is always enabled)\n\t\tthis.setAttribute('data-pointer-active', '');\n\n\t\t// 12. MutationObserver for React compat (childList changes)\n\t\tthis._observeChildren();\n\t}\n\n\tprivate _teardown(): void {\n\t\tif (!this._initialized) return;\n\n\t\tif (this._rafId) {\n\t\t\tcancelAnimationFrame(this._rafId);\n\t\t\tthis._rafId = 0;\n\t\t}\n\n\t\tif (this._observer) {\n\t\t\tthis._observer.disconnect();\n\t\t\tthis._observer = null;\n\t\t}\n\n\t\tif (this.core) {\n\t\t\tthis.core.destroy();\n\t\t\tthis.core = null;\n\t\t}\n\n\t\tif (this._styleEl) {\n\t\t\tthis._styleEl.remove();\n\t\t\tthis._styleEl = null;\n\t\t}\n\n\t\tthis.layoutModel = null;\n\t\tthis._initialized = false;\n\t}\n\n\tprivate _observeChildren(): void {\n\t\tthis._observer = new MutationObserver((mutations) => {\n\t\t\t// Only re-init when data-egg-item elements are added/removed.\n\t\t\t// Ignore internal DOM changes (style elements, placeholder, aria-live regions).\n\t\t\tlet itemsChanged = false;\n\t\t\tfor (const m of mutations) {\n\t\t\t\tfor (const node of m.addedNodes) {\n\t\t\t\t\tif (node instanceof HTMLElement && node.hasAttribute('data-egg-item')) {\n\t\t\t\t\t\titemsChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const node of m.removedNodes) {\n\t\t\t\t\tif (node instanceof HTMLElement && node.hasAttribute('data-egg-item')) {\n\t\t\t\t\t\titemsChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!itemsChanged) return;\n\n\t\t\tif (this._rafId) return;\n\t\t\tthis._rafId = requestAnimationFrame(() => {\n\t\t\t\tthis._rafId = 0;\n\t\t\t\tif (this.core?.phase === 'interacting') return;\n\t\t\t\tthis._teardown();\n\t\t\t\tthis._init();\n\t\t\t});\n\t\t});\n\n\t\tthis._observer.observe(this, { childList: true });\n\t}\n\n\tprivate _detectColumnCount(): number {\n\t\tconst style = getComputedStyle(this);\n\t\tconst cols = style.gridTemplateColumns.split(' ').filter(Boolean);\n\t\treturn Math.max(1, cols.length);\n\t}\n}\n","// Web component bundle — eg-grid + <eg-grid> custom element auto-registration\n\nexport * from '../eg-grid';\nexport { createLayoutModel } from '../layout-model';\nexport type { ItemDefinition, ItemPosition, CreateLayoutModelOptions, ResponsiveLayoutModel, BreakpointCSSOptions } from '../layout-model';\nexport { EgGridElement } from '../eg-grid-element';\n\nimport { EgGridElement } from '../eg-grid-element';\n\n// Auto-register the custom element\nif (!customElements.get('eg-grid')) {\n\tcustomElements.define('eg-grid', EgGridElement);\n}\n"],"mappings":"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"}